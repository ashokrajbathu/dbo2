<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>dbotica</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.3.5 -->
    <link class="cssdeck" rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/bootstrap-responsive.min.css" class="cssdeck">
    <link rel="stylesheet" href="css/jquery-ui.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="fonts/font-awesome/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="css/ionicons.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="dist/css/AdminLTE.css">
    <!-- iCheck -->
    <link rel="stylesheet" href="plugins/iCheck/square/blue.css">
    <link rel="stylesheet" type="text/css" href="login.css">
    <script src="plugins/sweetalert/dist/sweetalert.min.js"></script>
    <link rel="stylesheet" type="text/css" href="plugins/sweetalert/dist/sweetalert.css">
    <style type="text/css">
    @media (min-width: 1200px) {
        .container {
            width: 650px;
        }
    }
    </style>
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
    <!-- <div id="dialog-1" title="You are successfully signed up.....">dbotica team will contact you shortly!!</div> -->
    <!-- /.login-box -->
    <!-- jQuery 2.1.4 -->
    <div style="background-color:white;" class="loginBody">
        <div class="header">
            <h2 id="loginHeader">dbotica</h2>
        </div>
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-offset-3 col-md-6">
                    <div class="signInForm">
                        <div class="panel signinPanel">
                            <div class="panel-heading loginPanelHeading">
                                <h4 id="loginPanelHeader">Sign In</h4>
                            </div>
                            <div class="panel-body signInPanelBody">
                                <form class="form-horizontal">
                                    <div class="form-group">
                                        <label for="inputLoginEmail" class="col-md-2 col-sm-2 control-label">Email</label>
                                        <div class="col-sm-10  col-md-6">
                                            <input type="email" class="form-control" id="emailId" placeholder="UserName or Email">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputLoginPassword" class="col-sm-2 control-label">Password</label>
                                        <div class="col-sm-10 col-md-6">
                                            <input type="password" class="form-control" id="password" placeholder="Password">
                                        </div>
                                    </div>
                                </form>
                                <form class="col-md-offset-2 signInSubmitBtnForm col-sm-offset-2 form-inline">
                                    <div>
                                        <label>
                                            <input type="checkbox"> Remember me
                                        </label>
                                    </div>
                                    <button id="loginSubmitDoctor" class="btn btn-primary">Sign in</button>
                                </form>
                                <hr class="loginHr">
                                <form class="form-inline">
                                    <div>
                                        <label>Don't have an account! <a id="signupHere">Sign Up Here</a></label>
                                        <a href="assistant/index.html" class="pull-right" id="assistantLogin">Assistant Login</a>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="signUpForm hiddenForm">
                        <div class="panel signupPanel">
                            <div class="panel-heading signupPanelHeading">
                                <h4 id="signupPanelHeader">Sign Up</h4>
                            </div>
                            <div class="panel-body signupPanelBody">
                                <a class="pull-right" id="signInSignUp" style="cursor:pointer;">Sign In</a>
                                <br>
                                <form class="form-horizontal">
                                    <div class="form-group">
                                        <label for="inputDoctorName" class="col-sm-2 control-label">Name</label>
                                        <div class="col-sm-10 col-md-6">
                                            <input type="text" class="form-control" id="exampleInputName" placeholder="Name">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputDoctorPhone" class="col-sm-2 control-label">Phone</label>
                                        <div class="col-sm-10 col-md-6">
                                            <input type="text" class="form-control" id="exampleInputPhone" placeholder="Phone">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputDoctorEmail" class="col-sm-2 control-label">Email</label>
                                        <div class="col-sm-10 col-md-6">
                                            <input type="email" class="form-control" id="exampleInputEmail" placeholder="Email">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="signUpInsignUpform col-sm-offset-2 col-sm-10">
                                            <button id="signUpSubmitBtn" class="btn btn-primary">Sign Up</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script class="cssdeck" src="js/jquery.min.js"></script>
    <script src="js/jquery-ui.js"></script>
    <script class="cssdeck" src="js/bootstrap.min.js"></script>
    <!-- iCheck -->
    <script src="plugins/iCheck/icheck.min.js"></script>
    <script src="bootstrap/js/jquery.cookie.js"></script>
    <script>
    $(document).ready(function() {
        $('#signupHere').click(function() {
            $('.signInForm').hide();
            $('.signUpForm').removeClass('hiddenForm');
        });

        $('#signInSignUp').click(function() {
            $('.signInForm').show();
            $('.signUpForm').addClass('hiddenForm');
        });


        $(function() {
            $('input').iCheck({
                checkboxClass: 'icheckbox_square-blue',
                radioClass: 'iradio_square-blue',
                increaseArea: '20%' // optional
            });

            if (localStorage.getItem("isLoggedIn") == "true") {
                window.location.replace("entryPrescriptions.html");
            }
        });

        $('.signInSubmitBtnForm').on('click', '#loginSubmitDoctor', function(e) {
            e.preventDefault();
            $('.signUpForm').hide();
            var patientsListOfDoctor = [];
            var json_str = [];
            var emailId = $('#emailId').val();
            var password = $('#password').val();
            console.log("emailId: " + emailId + ", password: " + password);
            // console.log(localStorage.getItem("password"));
            $.ajax({
                type: "POST",
                url: "http://localhost:8081/dbotica-spring/doctor/login",
                beforeSend: function(xhr) {
                    xhr.setRequestHeader("Content-Type", "application/json");
                    xhr.setRequestHeader("Accept", "application/json");
                },
                xhrFields: {
                    withCredentials: true
                },
                data: JSON.stringify({
                    'emailId': emailId,
                    'password': password
                }),
                success: function(response) {
                    console.log("in success---");
                    var errorCode = response.errorCode;
                    if (!!errorCode) {
                        switch (errorCode) {
                            case "BAD_CREDENTIALS":
                                swal({
                                    title: "Error",
                                    text: "Incorrect email or password.",
                                    type: "error",
                                    confirmButtonText: "OK",
                                    allowOutsideClick: true,
                                    function() {
                                        window.location.reload();
                                    }
                                });
                                break;
                            case "USER_ALREADY_LOGGED_IN":
                                localStorage.setItem("isLoggedIn", true);
                                window.location = "entryPrescriptions.html";
                                break;
                        }
                    } else {
                        console.log("doctor details before prse is----", response.response);
                        var data = $.parseJSON(response.response);
                        console.log("doctor details are---", data);
                        localStorage.setItem('doctorPojo', response.response);
                        localStorage.setItem("isLoggedIn", true);
                        localStorage.setItem("firstName", data['firstName']);
                        localStorage.setItem("lastName", data['lastName']);
                        localStorage.setItem("doctorId", data['id']);
                        var idOfLoggedInDoctor = data['id'];
                        console.log("doctor id of the doctor who is logging in-----" + idOfLoggedInDoctor);
                        localStorage.setItem("creditsOfDoctor", data['credits']);
                        localStorage.setItem("doctorSpeciality", data['speciality']);
                        localStorage.setItem("doctorOrganization", data['organization']);
                        localStorage.setItem("doctorQualification", data['qualification']);
                        localStorage.setItem("doctorPublicPhoneNumber", data['phoneNumber']);
                        localStorage.setItem("doctorOfficeAddress", data['officeAddress']);
                        localStorage.setItem("doctorRegistrationNo", data['doctorRegistrationNo']);
                        /*localStorage.setItem("doctorHospitalLocation", data['city']);*/
                        console.log(localStorage.getItem("firstName"));
                        $.cookie('doctorCurrentlyLoggedInId', idOfLoggedInDoctor);
                        $.ajax({
                            type: 'GET',
                            url: 'http://localhost:8081/dbotica-spring/doctor/getAddress',
                            beforeSend: function(xhr) {
                                xhr.setRequestHeader("Content-Type", "application/json");
                                xhr.setRequestHeader("Accept", "application/json");
                            },
                            xhrFields: {
                                withCredentials: true
                            },
                            success: function(responseOfAddresses) {
                                var addressesList = $.parseJSON(responseOfAddresses.response);
                                console.log("in setting up of address----", addressesList);
                                if (addressesList.length > 0) {
                                    var addressOfTheDoctor = addressesList[0].address + ' ' + addressesList[0].city;
                                    console.log("address is---", addressOfTheDoctor);
                                    localStorage.setItem("doctorHospitalLocation", addressOfTheDoctor);
                                } else {
                                    var address = "";
                                    localStorage.setItem("doctorHospitalLocation", address);
                                }
                                window.location = "entryPrescriptions.html";
                            }
                        });
                    }
                }
            });
        });
        $(".signUpInsignUpform").on('click', '#signUpSubmitBtn', function(e) {
            e.preventDefault();
            var name = $("#exampleInputName").val();
            var email = $("#exampleInputEmail").val();
            var phone = $("#exampleInputPhone").val();
            if (name === "" || (email === "" && phone === "")) {
                console.log("in sign swal---");
                $('.signInForm').hide();
                $('.signUpForm').show();
                swal({
                    title: "Error",
                    text: "Kindly enter the details",
                    type: "error",
                    confirmButtonText: "OK",
                    allowOutsideClick: true
                });
                console.log("after swal--");
            } else {
                $.ajax({
                    type: 'POST',
                    url: 'http://localhost:8081/dbotica-spring/doctor/referDoctor',
                    beforeSend: function(xhr) {
                        xhr.setRequestHeader("Content-Type", "application/json");
                        xhr.setRequestHeader("Accept", "application/json");
                    },

                    data: JSON.stringify({
                        'doctorName': name,
                        'emailId': email,
                        'phoneNumber': phone

                    }),
                    success: function(response) {
                        console.log('response is---', response);
                        swal({
                            title: "Success",
                            text: "Thank You!! dBotica team will call you shortly",
                            type: "success",
                            confirmButtonText: "OK",
                            allowOutsideClick: true
                        });

                    },
                    error: function(request, status, error) {
                        swal({
                            title: "Error",
                            text: "Error receiving the details. Kindly try after some time",
                            type: "error",
                            confirmButtonText: "OK",
                            allowOutsideClick: true
                        });
                    }

                });
            }
        });
    });
    </script>
</body>

</html>
