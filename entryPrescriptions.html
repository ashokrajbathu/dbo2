<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>dbotica</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.3.5 -->
    <link href="css/jquery-ui.css" rel="stylesheet">
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="//code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="dist/css/AdminLTE.css">
    <!-- AdminLTE Skins. Choose a skin from the css/skins
    folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" href="dist/css/skins/_all-skins.min.css">
    <link rel="stylesheet" href="entryPrescription.css">
    <!--Datepicker srcs 
    <link rel="stylesheet" href="css/datepicker.css" type="text/css" />-->
    <script src="plugins/jQuery/jquery-1.9.1.js"></script>
    <link rel="stylesheet" type="text/css" href="bootstrap/css/jquery.jscrollpane.css">
    <script type="text/javascript" src="bootstrap/js/jquery.mousewheel.js"></script>
    <script type="text/javascript" src="bootstrap/js/jquery.jscrollpane.min.js"></script>
    <script type="text/javascript">
    $.holdReady(true);
    if (localStorage.getItem('isLoggedIn') === 'true') {
        $.holdReady(false);
    } else {
        window.location.href = 'login.html';
    }
    </script>
    <!--  <link rel="stylesheet" media="screen" type="text/css" href="css/layout.css" />
    <script type="text/javascript" src="js/datepicker.js"></script>
    <script type="text/javascript" src="js/layout.js?ver=1.0.2"></script>-->
    <script src="js/jquery-ui.js"></script>
    <script type="text/javascript" src="js/eye.js"></script>
    <script type="text/javascript" src="js/utils.js"></script>
    <script src="plugins/sweetalert/dist/sweetalert.min.js"></script>
    <link rel="stylesheet" type="text/css" href="plugins/sweetalert/dist/sweetalert.css">
    <script src="js/moment.min.js"></script>
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
</head>

<body style="overflow:auto;" class="hold-transition skin-blue sidebar-mini control-sidebar-open">
    <div class="wrapper">
        <header id="header" class="fixed-content main-header">
            <a href="entryPrescriptions.html" class="logo fixed" style="width: 13%;">
                <span class="logo-mini"><b>db</b></span>
                <span class="logo-lg"><b>dbotica</b></span>
            </a>
            <!-- Logo -->
            <!-- Header Navbar: style can be found in header.less -->
            <nav class="navbar navbar-fixed-top" role="navigation" style="margin-left: 13%;">
                <!-- Sidebar toggle button-->
                <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </a>
                <div class="navbar-custom-menu">
                    <ul class="nav navbar-nav">
                        <li class="dropdown user user-menu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <img src="dist/img/doctor (1).png" class="user-image" alt="User Image">
                                <span id="doctorNameInTheHeader" class="hidden-xs"></span>
                            </a>
                            <ul class="dropdown-menu">
                                <!-- User image -->
                                <li class="user-header">
                                    <img src="dist/img/doctor (1).png" class="img-circle" alt="User Image">
                                    <p id="doctorName">
                                    </p>
                                </li>
                                <!-- Menu Body -->
                                <!-- Menu Footer-->
                                <li class="user-footer">
                                    <div class="pull-left">
                                        <a href="doctorProfile.html" class="btn btn-default btn-flat">Profile</a>
                                    </div>
                                    <div class="pull-right">
                                        <a href="#" class="btn btn-default btn-flat" id="logoutButton">Sign out</a>
                                    </div>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>
        <!-- Left side column. contains the logo and sidebar -->
        <aside class="fixed-side-content main-sidebar" style="width: 13%;">
            <!-- sidebar: style can be found in sidebar.less -->
            <section class="sidebar">
                <!-- <a href="entryPrescriptions.html" class="logo">
                    <span class="logo-mini"><b>db</b></span>
                    <span class="logo-lg"><b>dbotica</b></span>
                </a> -->
                <!-- Sidebar user panel (optional) -->
                <div style="height:80px;" class="user-panel">
                    <div class="pull-left image">
                        <img src="dist/img/doctor (1).png" class="img-circle" alt="User Image">
                    </div>
                    <div class="pull-left info">
                        <p id="doctorNameInSideBar"></p>
                        <!-- Status -->
                        <span style="margin-bottom:2px;">Credits:<b style="color:white;" id="creditsInSideBar"></b></span>
                        <br>
                        <a href="doctorProfile.html">Profile</a>
                    </div>
                </div>
                <!-- Sidebar Menu -->
                <ul class="sidebar-menu">
                    <li class="header">Welcome</li>
                    <!-- Optionally, you can add icons to the links -->
                    <li class="active"><a href="entryPrescriptions.html"><i class="fa fa-link"></i> <span>Drug prescription</span></a></li>
                    <li><a href="myPrescriptions.html"><i class="fa fa-link"></i> <span>My Prescriptions</span></a></li>
                    <li><a href="myPatients.html"><i class="fa fa-link"></i> <span>My Patients</span></a></li>
                    <li><a href="myScheduler.html"><i class="fa fa-link"></i> <span>My Scheduler</span></a></li>
                    <li><a href="referADoctor.html"><i class="fa fa-link"></i> <span>Refer dbotica</span></a></li>
                    <li><a href="settings.html"><i class="fa fa-link"></i> <span>Settings</span></a></li>
                    <!--  <li class="active"><a href="../forms/PatientSearch.html"><i class="fa fa-link"></i> <span>Patient Search</span></a></li>  -->
                    <li class="treeview">
                        <!--  <a href="../tables/data.html"><i class="fa fa-link"></i> <span>Drug database</span> <i class="fa fa-angle-left pull-right"></i></a> -->
                    </li>
                </ul>
                <!-- /.sidebar-menu -->
            </section>
            <!-- /.sidebar -->
        </aside>
        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper" style="margin-left: 13%;margin-right: 22%;margin-top:3%;">
            <!-- Content Header (Page header) -->
            <section class="content-header">
                <div class="col-md-14">
                    <div class="box">
                        <h3 class="box-title"></h3>
                        <button type="submit" class="btn btn-primary pull-right" id="prescription-reset">Reset</button>
                    </div>
                    <!-- /.box-header -->
                </div>
                <h1>
                Prescriptions Form
                <!-- <small>Preview</small> -->
              </h1>
                <!-- <ol class="breadcrumb">
            <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
            <li><a href="#">Forms</a></li>
            <li class="active">General Elements</li>
          </ol> -->
            </section>
            <!-- Main content -->
            <section class="content">
                <div class="row">
                    <div class="col-xs-12">
                        <div class="box box-solid box-primary">
                            <div class="box-header">
                                <h3 class="box-title">Patient Data</h3>
                            </div>
                            <!-- /.box-header -->
                            <div class="box-body">
                                <div role="form" id="prescription-form-pd">
                                    <div class="col-md-3 form-group">
                                        <label>Patient Name</label>
                                        <span class="form-control" placeholder="Patient Name" value="Type" id="prescription-form-patient-name" style="background-color: #eee;">
               </span>
                                    </div>
                                    <div class="col-md-2 form-group">
                                        <label>Weight in kgs</label>
                                        <input type="text" class="form-control" placeholder="Weight" id="prescription-form-weight">
                                        </input>
                                    </div>
                                    <div class="col-md-2 form-group">
                                        <label>Height in cms</label>
                                        <input type="text" class="form-control" placeholder="Height" id="prescription-form-height">
                                        </input>
                                    </div>
                                    <div class="col-md-2 form-group">
                                        <label>Temperature</label>
                                        <input type="text" class="form-control" placeholder="Temperature" id="prescription-form-temp">
                                        </input>
                                    </div>
                                    <div class="col-md-3 form-group">
                                        <label>Blood Pressure</label>
                                        <input type="text" class="form-control" placeholder="Blood Pressure" id="prescription-form-bloodPressure">
                                        </input>
                                    </div>
                                    <div class="col-md-3 form-group">
                                        <label>BMI</label>
                                        <input type="text" class="form-control" placeholder="BMI" id="prescription-form-bmi">
                                        </input>
                                    </div>
                                    <div class="col-md-2 form-group">
                                        <label>Saturation</label>
                                        <input type="text" class="form-control" placeholder="Saturation" id="prescription-form-saturation">
                                        </input>
                                    </div>
                                    <div class="col-md-2 form-group">
                                        <label>Pulse</label>
                                        <input type="text" class="form-control" placeholder="Pulse" id="prescription-form-pulse">
                                        </input>
                                    </div>
                                    <div class="col-md-4 form-group">
                                        <label>Drug Allergy</label>
                                        <input type="text" class="form-control" placeholder="Drug Allergy" disabled="true" id="prescription-form-drug-allergy">
                                        </input>
                                    </div>
                                </div>
                            </div>
                            <!-- /.box-body -->
                        </div>
                        <!-- /.box -->
                    </div>
                    <!-- /.col -->
                </div>
                <!-- /.row -->
            </section>
            <section class="content">
                <div class="row">
                </div>
                <!--/.col (left) -->
                <!-- right column -->
                <div class="col-md-14">
                    <!-- general form elements disabled -->
                    <div class="box box-solid box-primary">
                        <div class="box-header">
                            <h3 class="box-title">Investigation</h3>
                        </div>
                        <div class="box-body">
                            <div role="form" id="Investigation-form">
                                <div class="col-md-12 form-group">
                                    <textarea class="form-control" rows="2" placeholder="Symptoms" id="prescription-form-Symptoms"></textarea>
                                </div>
                                <div class="col-md-12 form-group">
                                    <textarea class="form-control" rows="2" placeholder="Investigation Report" id="prescription-form-Investigation"></textarea>
                                </div>
                                <div class="col-md-12 form-group">
                                    <textarea class="form-control" rows="2" placeholder="History" id="prescription-form-history"></textarea>
                                </div>
                            </div>
                        </div>
                        <!-- /.box-body -->
                    </div>
                    <!-- /.box -->
                </div>
                <!--/.col (right) -->
                <!-- /.row -->
            </section>
            <!-- /.content -->
            <section class="content">
                <div class="row">
                </div>
                <!--/.col (left) -->
                <!-- right column -->
                <div class="col-md-14">
                    <!-- general form elements disabled -->
                    <div class="box box-solid box-primary">
                        <div class="box-header">
                            <h3 class="box-title">Tests</h3>
                        </div>
                        <!-- /.box-header -->
                        <div class="box-body">
                            <div class="col-md-6 form-group">
                                <input type="text" class="form-control" placeholder="Test" id="prescription-form-test"></input>
                                <ul class="dropdown-menu tests-dropdown-menu">
                                </ul>
                            </div>
                            <div class="col-md-4 form-group">
                                <input type="text" class="form-control" placeholder="Remark" id="prescription-form-test-remark"></input>
                                </ul>
                            </div>
                            <div align="right">
                                <button type="submit" class="btn btn-primary" id="prescription-test-add">Add</button>
                            </div>
                            <table id="current-tests" class="table table-bordered table-striped">
                                <thead>
                                    <tr>
                                        <th>S.No</th>
                                        <th>Test Name</th>
                                        <th>Remarks</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="box box-solid box-primary">
                        <div class="box-header">
                            <h3 class="box-title">Fill Prescription</h3>
                        </div>
                        <div class="box-body">
                            <!-- <h5 id="drugWarning">(**Please select the drug to which patient is not allergic)</h5> -->
                            <div role="form" id="prescription-form">
                                <!-- text input -->
                                <div class="col-md-9 form-group">
                                    <!-- <label>Text</label> -->
                                    <input type="text" class="form-control" data-validation="required" placeholder="Drug" id="prescription-form-drug">
                                    <span id="searchclear" class="glyphicon glyphicon-remove-circle"></span>
                                    <ul class="dropdown-menu drugs-dropdown-menu">
                                    </ul>
                                </div>
                                <div class="col-md-2 form-group">
                                    <!-- <label>Text</label> -->
                                    <span class="form-control" placeholder="drug type" value="Type" id="prescription-form-drug-type" style="background-color: #eee;">
          </span>
                                </div>
                                <div class="col-md-1 form-group">
                                    <button id="medicinesModalBtn" class="btn btn-primary" data-toggle="modal" data-target="#medicinesModal">+</button>
                                </div>
                                <div id="medicinesModal" class="modal fade" role="dialog">
                                    <div class="modal-dialog">
                                        <!-- Modal content-->
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                <h4 class="modal-title">Medicines List</h4>
                                            </div>
                                            <div id="medicinesListModalBody" class="modal-body">
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-2 form-group">
                                    <!-- <label>Text</label> -->
                                    <input type="number" class="form-control" placeholder="Per Serving" id="prescription-form-serving">
                                    </input>
                                </div>
                                <div class="col-md-2 form-group">
                                    <!-- <label>Text</label> -->
                                    <p class="form-control" placeholder="" id="prescription-form-measurmnt" style="background-color: #eee;"> units </p>
                                </div>
                                <div class="col-md-2 form-group">
                                    <!-- <label>Text</label> -->
                                    <select class="form-control" placeholder="Days" id="prescription-form-days">
                                        <option name="Days">Days</option>
                                        <option name="Quantity">Quantity</option>
                                    </select>
                                </div>
                                <div class="col-md-1 form-group input-group spinner">
                                    <input type="number" class="form-control" value="1" id="prescription-form-units"></input>
                                    <div class="input-group-btn-vertical">
                                        <button class="btn btn-default" type="button"><i class="fa fa-caret-up"></i></button>
                                        <button class="btn btn-default" type="button"><i class="fa fa-caret-down"></i></button>
                                    </div>
                                </div>
                                <div class="col-md-12 form-group">
                                    <textarea class="form-control" rows="3" placeholder="Special Instructions" id="prescription-form-si"></textarea>
                                </div>
                                <div class="col-md-12 form-group">
                                    <input type="button" id="prescription-form-BBF" class="prescription-form-toggle-buttons col-md-1 btn btn-default btn-xs" value="BBF"></input>
                                    <input type="button" id="prescription-form-ABF" class="prescription-form-toggle-buttons col-md-1 btn btn-default btn-xs" value="ABF"></input>
                                    <input type="button" id="prescription-form-BL" class="prescription-form-toggle-buttons col-md-1 btn btn-default btn-xs" value="BL"></input>
                                    <input type="button" id="prescription-form-AL" class="prescription-form-toggle-buttons col-md-1 btn btn-default btn-xs" value="AL"></input>
                                    <input type="button" id="prescription-form-BD" class="prescription-form-toggle-buttons col-md-1 btn btn-default btn-xs" value="BD"></input>
                                    <input type="button" id="prescription-form-AD" class="prescription-form-toggle-buttons col-md-1 btn btn-default btn-xs" value="AD"></input>
                                </div>
                                <div class="col-md-12" id="prescription-form-information" style="display: none;">
                                    <label>Information: </label>
                                    <div id="prescription-form-information-text"></div>
                                </div>
                            </div>
                        </div>
                        <!-- /.box-body -->
                        <div class="box-footer" align="right">
                            <button type="submit" class="btn btn-primary" id="prescription-add">Add</button>
                        </div>
                    </div>
                    <!-- /.box -->
                </div>
                <!--/.col (right) -->
                <!-- /.row -->
            </section>
            <!-- /.content -->
            <!-- Main content -->
            <section class="content">
                <div class="row">
                    <div class="col-xs-12">
                        <div class="box box-solid box-primary">
                            <div class="box-header">
                                <h3 class="box-title">List of drugs</h3>
                            </div>
                            <!-- /.box-header -->
                            <div class="box-body">
                                <table id="current-prescriptions" class="table table-bordered table-striped">
                                    <thead>
                                        <tr>
                                            <th>S.No</th>
                                            <th>BrandName</th>
                                            <th>Per Serving</th>
                                            <th>Days/Quantity</th>
                                            <th>Usage</th>
                                            <th>Remarks</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                            <!-- /.box-body -->
                        </div>
                        <!-- /.box -->
                        <div class="box box-solid box-primary">
                            <div class="box-header">
                                <h3 class="box-title">Remarks</h3>
                            </div>
                            <!-- /.box-header -->
                            <div class="box-body">
                                <div class="col-md-8 form-group pull-left">
                                    Revisit after :
                                    <input type="number" id="inputDatetxt" name="inputDatetxt" style="width :50px" /> days &nbsp;&nbsp;&nbsp;&nbsp;
                                    <input type="text" class="inputDate" id="inputDate" name="inputDate" value="" style="width :100px">
                                    <!-- <span class="glyphicon glyphicon-calendar" class="inputDate" id="inputDateSpan"></span>
                                    <p hidden>
                                        <label id="closeOnSelect">
                                            <input type="checkbox" checked="true" /> Close on selection</label>
                                    </p> -->
                                    &nbsp;&nbsp;&nbsp;&nbsp;
                                    <input type="button" id="prescription-book-appointment" name="book-appointment" value="Book Appointment" />
                                </div>
                                <div class="col-md-7 form-group">
                                    Refer To :
                                    <input type="text" id="referToDoctor" name="referToDoctor">
                                </div>
                                <div class="col-md-13 form-group">
                                    <textarea class="form-control" rows="2" placeholder="Additional Comments" id="prescription-form-remarks"></textarea>
                                </div>
                                <div class="box-footer">
                                    <button type="submit" class="btn btn-primary pull-left" id="prescription-reset-btm">Reset</button>
                                    <button type="submit" class="btn btn-primary pull-right" id="prescription-save-cont">Save and Continue</button>
                                </div>
                            </div>
                            <!-- /.box-body -->
                        </div>
                    </div>
                    <!-- /.col -->
                </div>
                <!-- /.row -->
            </section>
            <!-- /.content -->
        </div>
        <!-- /.content-wrapper -->
        <footer class="main-footer" style="margin-left: 13%;margin-right: 22%;">
            <div class="pull-right hidden-xs">
                <b>Version</b> 1.0.0
            </div>
            <strong>Copyright &copy; 2015-2016 <a href="https://dbotica.com">Dbotica</a>.</strong> All rights reserved.
        </footer>
        <!-- Control Sidebar -->
        <!-- Control Sidebar -->
        <aside class="control-sidebar control-sidebar-light" style="position: fixed;height:100%; width: 22%;">
            <!-- Create the tabs -->
            <!-- Tab panes -->
            <div id="patientSearchAside">
                <p class="login-box-msg" style="margin-top: 7%;">Patient search</p>
                <form action="index.html" method="post" style="margin-left: 5%; margin-right: 5%; margin-bottom: 5%; 
  margin-top: 2%;">
                    <div class="form-group has-feedback">
                        <input type="text" class="form-control" id="patient-search-telephone" placeholder="Mobile Number">
                        <span class="glyphicon glyphicon-phone form-control-feedback"></span>
                    </div>
                    <div class="form-group has-feedback">
                        <input type="email" class="form-control" id="patient-search-uniqueid" placeholder="Dbotica Id">
                        <span class="glyphicon glyphicon-envelope form-control-feedback"></span>
                    </div>
                    <div class="row">
                        <div class="col-xs-4">
                        </div>
                        <!-- /.col -->
                        <div class="col-xs-4">
                            <button type="submit" id="patient-search" class="btn btn-primary btn-block btn-flat">Search</button>
                        </div>
                        <!-- /.col -->
                    </div>
                    <div class="row">
                    </div>
                </form>
            </div>
            <div class="login-box-msg" id="patient-search-result" style="margin-top: 7%;"></div>
            <!--<div id="patient-search-result"></div>-->
        </aside>
        <!-- /.control-sidebar -->
        <!-- Add the sidebar's background. This div must be placed
      immediately after the control sidebar -->
        <div class="control-sidebar-bg"></div>
    </div>
    <!-- ./wrapper -->
    <!--added for register pop up --->
    <!-- jQuery 2.1.4 -->
    <!-- Bootstrap 3.3.5 -->
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="bootstrap/js/jquery.cookie.js"></script>
    <!-- FastClick -->
    <script src="plugins/fastclick/fastclick.min.js"></script>
    <!-- DataTables -->
    <script src="plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="plugins/datatables/dataTables.bootstrap.min.js"></script>
    <!--script type="text/javascript" src="datepicker/js/datepicker.js"></script>
  <!--<link rel="stylesheet" media="screen" type="text/css" href="datepicker/css/datepicker.css" />
  <script type="text/javascript" src="datepicker/js/datepicker.js"></script>
  <script type="text/javascript" src="datepicker/js/eye.js"></script>
  <script type="text/javascript" src="datepicker/js/jquery.js"></script>
  <script type="text/javascript" src="datepicker/js/utils.js"></script>
  <script type="text/javascript" src="datepicker/js/layout.js?ver=1.0.2"></script>
  <link rel="stylesheet" media="screen" type="text/css" href="datepicker/css/layout.css">-->
    <!-- AdminLTE App -->
    <script src="dist/js/app.min.js"></script>
    <!-- AdminLTE for demo purposes -->
    <script src="dist/js/demo.js"></script>
    <!-- IndexedDB for local storage-->
    <script src="indexedDB/indexedDbotica.js"></script>
    <link rel="stylesheet" href="css/ionicons.css">
    <script type="text/javascript">
    var totalDrugObjectsOnReady = [];
    /*$.fn.pageMe = function(opts) {
        var $this = this,
            defaults = {
                perPage: 7,
                showPrevNext: false,
                numbersPerPage: 1,
                hidePageNumbers: false
            },
            settings = $.extend(defaults, opts);

            0,1,2,3,4,5,6,7,8,9,10,......

            0,4,8,.....

            a+(n-1)d
            3(n-1)
            3n-2
            3n-1
            3n

        var listElement = $this;
        var perPage = settings.perPage;
        var children = listElement.children();
        var pager = $('.pagination');

        if (typeof settings.childSelector != "undefined") {
            children = listElement.find(settings.childSelector);
        }

        if (typeof settings.pagerSelector != "undefined") {
            pager = $(settings.pagerSelector);
        }

        var numItems = children.size();
        var numPages = Math.ceil(numItems / perPage);
        console.log("number of pages ", numPages);
        var curr = 0;
        pager.data("curr", curr);

        if (settings.showPrevNext) {
            $('<li><a href="#" class="prev_link">«</a></li>').appendTo(pager);
        }

        while (numPages > curr && (settings.hidePageNumbers == false)) {
            $('<li><a href="#" class="page_link">' + (curr + 1) + '</a></li>').appendTo(pager);
            curr++;
        }

        if (settings.numbersPerPage > 1) {
            $('.page_link').hide();
            $('.page_link').slice(pager.data("curr"), settings.numbersPerPage).show();
        }

        if (settings.showPrevNext) {
            $('<li><a href="#" class="next_link">»</a></li>').appendTo(pager);
        }

        pager.find('.page_link:first').addClass('active');
        pager.find('.prev_link').hide();
        if (numPages <= 1) {
            pager.find('.next_link').hide();
        }
        pager.children().eq(0).addClass("active");

        children.hide();
        children.slice(0, perPage).show();

        pager.find('li .page_link').click(function() {
            var clickedPage = $(this).html().valueOf() - 1;
            goTo(clickedPage, perPage);
            return false;
        });
        pager.find('li .prev_link').click(function() {
            previous();
            return false;
        });
        pager.find('li .next_link').click(function() {
            next();
            return false;
        });

        function previous() {
            var goToPage = parseInt(pager.data("curr")) - 1;
            goTo(goToPage);
        }

        function next() {
            goToPage = parseInt(pager.data("curr")) + 1;
            goTo(goToPage);
        }

        function goTo(page) {
            var startAt = page * perPage,
                endOn = startAt + perPage;

            children.css('display', 'none').slice(startAt, endOn).show();

            if (page >= 1) {
                pager.find('.prev_link').show();
            } else {
                pager.find('.prev_link').hide();
            }

            if (page < (numPages - 1)) {
                pager.find('.next_link').show();
            } else {
                pager.find('.next_link').hide();
            }

            pager.data("curr", page);

            if (settings.numbersPerPage > 1) {
                $('.page_link').hide();
                $('.page_link').slice(page, settings.numbersPerPage + page).show();
            }

            pager.children().removeClass("active");
            pager.children().eq(page + 1).addClass("active");

        }
    };*/


    function OnGetTestsResponse(data) {
        var dropdown = $('.tests-dropdown-menu');
        if (data.length != 0) {
            for (var i in data) {
                var test = data[i];
                var testString = test['diagnosisTest'];
                dropdown.append('<li id="' + test['id'] + '"><a href="#">' + testString);
            }
            $('.tests-dropdown-menu > li').click(function(e) {
                e.preventDefault();
                var id = $(this).get(0).id;
                for (var s in data) {
                    if (data[s]['id'] === id) {
                        console.log(data[s]);
                        $('#prescription-form-test').val(data[s]['diagnosisTest']);
                        $('#prescription-form-test').attr("testId", data[s][id]);
                        break;
                    }
                }
                dropdown.hide('dropdown');
            });
            dropdown.show('dropdown');

        }

    }

    function prescriptionFormTestCallback() {
        var testName = $('#prescription-form-test').val();
        if (testName === "") {
            $('.tests-dropdown-menu').hide('dropdown');
            return;
        }

        $('.tests-dropdown-menu').hide('dropdown');
        $('.tests-dropdown-menu').empty();

        $.ajax({
            type: "GET",
            url: "http://localhost:8081/dbotica-spring/diagnosis/getDiagnosisTest",
            data: {
                'diagnosisTest': testName
            },
            xhrFields: {
                withCredentials: true
            },
            success: function(response) {
                var errorCode = response.errorCode;
                if (!!errorCode) {
                    switch (errorCode) {
                        case "NO_USER_LOGGED_IN":
                            localStorage.setItem("isLoggedIn", false);
                            swal({
                                    title: "Error",
                                    text: "You are not logged into your account. Kindly login again to view this page",
                                    type: "error",
                                    confirmButtonText: "OK"
                                },
                                function() {
                                    localStorage.setItem("isLoggedIn", false);
                                    window.location.href = "login.html";
                                }
                            );
                            break;
                    }
                }

                if (testName === $('#prescription-form-test').val()) {
                    var data = $.parseJSON(response.response);
                    console.log(data);
                    OnGetTestsResponse(data);

                }
            }
        });
    }


    $('#prescription-form-test').keyup(function(e) {
        e.preventDefault();
        delay(prescriptionFormTestCallback, 300);
    });

    $('#prescription-test-add').click(function(e) {
        e.preventDefault();
        var test = $('#prescription-form-test').val();
        var testId = $('#prescription-form-test').attr("testId");
        var remark = $('#prescription-form-test-remark').val();
        if (!test)
            return;
        var count = $.cookie('testEntryCount');
        if (!count) {
            count = 1;

        }
        var testPojoList = [];
        if ($.cookie('testPojoList') && $.cookie('testPojoList') !== "") {
            testPojoList = $.parseJSON($.cookie('testPojoList'));
        }
        var testPojo = {};
        testPojo['diagnosisTest'] = test;
        testPojo['testId'] = testId;
        testPojo['remark'] = remark;
        $('#current-tests > tbody').append('<tr><td>' + count + '</td><td>' + test + '</td><td>' + remark + '<td id ="deleteTest' + count + '"><button type ="submit" name = "deleteButton" class = "deleteTestButton" id ="deleteTestButton' + count + '" value="deleteTest' + count + '">Delete</button></td></tr>');
        //$('#current-tests').DataTable();
        $.cookie('testHtml', $('#current-tests > tbody').html());
        var countNum = Number(count);
        testPojoList.push(testPojo);
        $.cookie('testPojoList', JSON.stringify(testPojoList));
        countNum++;
        $.cookie('testEntryCount', countNum);

        $('#prescription-form-test').val('');
        $('#prescription-form-test-remark').val('');

    });

    $(document).on('click', '.deleteTestButton', function(e) {
        var result = confirm('Are you sure, you want to delete ?');

        if (result) {
            $.cookie('testEntryCount', "");
            $.cookie('testHtml', "");
            var id = this.id;
            id = id.slice(-1);
            id = id - 1;
            console.log(id);
            var testPojoList1 = $.cookie('testPojoList');
            var testData = JSON.parse(testPojoList1);
            console.log(testData);
            if (testData.length != 0) {
                for (i in testData) {
                    if (i == id) {
                        var removedObject = testData.splice(id, 1);
                        console.log("testData ", testData);
                        break;
                    }
                }
            }
            var newCount = 1;
            $('#current-tests > tbody').text("");
            testPojoList = [];
            $.cookie('testPojoList', "");
            for (s in testData) {
                $('#current-tests > tbody').append('<tr><td>' + newCount + '</td><td>' + testData[s]['diagnosisTest'] + '</td><td>' + testData[s]['remark'] + '</td><td id ="deleteTest' + newCount + '"><button type ="submit" name = "deleteButton" class = "deleteTestButton" id ="deleteTestButton' + newCount + '" value="deleteTest' + newCount + '">Delete</button></td></tr>');
                newCount++;
                try {
                    testPojoList.push(testData[s]);
                } catch (e) {

                }
            }
            $.cookie('testPojoList', JSON.stringify(testPojoList));
            console.log('pushed');
            $.cookie('testEntryCount', newCount);
            //$('#current-tests').DataTable();
            //console.log($('#current-tests').DataTable());
            $.cookie('testHtml', $('#current-tests > tbody').html());

        }
    });


    var drugPojo1 = {};
    (function($) {
        try {
            openDb();
        } catch (e) {
            console.log("Error in openDb");
        }


        $('.spinner .btn:first-of-type').on('click', function() {
            $('.spinner input').val(parseInt($('.spinner input').val(), 10) + 1);
        });
        $('.spinner .btn:last-of-type').on('click', function() {
            if (parseInt($('.spinner input').val(), 10) != 1)
                $('.spinner input').val(parseInt($('.spinner input').val(), 10) - 1);
        });
        $('.prescription-form-toggle-buttons').click(function(e) {
            var button = $(this);
            if (button.hasClass('btn-default')) {
                button.removeClass('btn-default').addClass('btn-success');
            } else if (button.hasClass('btn-success')) {
                button.removeClass('btn-success').addClass('btn-default');
            }
        })
    })(jQuery);

    $('#prescription-add').click(function(e) {
        e.preventDefault();
        var drug = "";
        drug = $("#prescription-form-drug").val();
        var drugId = $("#prescription-form-drug").attr("drugId");
        var days = $("#prescription-form-days").val();
        var units = $("#prescription-form-units").val();
        var drugType = $("#prescription-form-drug-type").text();
        var per_serving = $("#prescription-form-serving").val();
        var msrmnt = $('#prescription-form-measurmnt').text();

        var si = $("#prescription-form-si").val();
        var bbf = $("#prescription-form-BBF").hasClass('btn-success');
        var abf = $("#prescription-form-ABF").hasClass('btn-success');
        var bl = $("#prescription-form-BL").hasClass('btn-success');
        var al = $("#prescription-form-AL").hasClass('btn-success');
        var bd = $("#prescription-form-BD").hasClass('btn-success');
        var ad = $("#prescription-form-AD").hasClass('btn-success');
        var price = $("#prescription-form-price").text();
        var constituents = $("#prescription-form-constituents").text();
        var usage = "";
        var quantCount = 0;
        if ($("#prescription-form-BBF").hasClass('btn-success')) {
            usage = "Before BreakFast";
            quantCount++;
        }
        if ($("#prescription-form-ABF").hasClass('btn-success')) {
            if (usage == "") {
                usage = "After BreakFast";
            } else {
                usage = usage + ", " + "After BreakFast";
            }
            quantCount++;
        }
        if ($("#prescription-form-BL").hasClass('btn-success')) {
            if (usage == "") {
                usage = "Before Lunch";
            } else {
                usage = usage + ", " + "Before Lunch";
            }
            quantCount++;
        }
        if ($("#prescription-form-AL").hasClass('btn-success')) {
            if (usage == "") {
                usage = "After Lunch";
            } else {
                usage = usage + ", " + "After Lunch";
            }
            quantCount++;
        }
        if ($("#prescription-form-BD").hasClass('btn-success')) {
            if (usage == "") {
                usage = "Before Dinner";
            } else {
                usage = usage + ", " + "Before Dinner";
            }
            quantCount++;
        }
        if ($("#prescription-form-AD").hasClass('btn-success')) {
            if (usage == "") {
                usage = "After Dinner";
            } else {
                usage = usage + ", " + "After Dinner";
            }
            quantCount++;
        }

        var count = $.cookie('drugEntryCount');
        if (!count) {
            count = 1;
        }

        var drugPojoList = [];
        if ($.cookie('drugPojoList') && $.cookie('drugPojoList') !== "") {
            drugPojoList = $.parseJSON($.cookie('drugPojoList'));
        }
        var drugPojo = {};
        drugPojo['drugId'] = drugId;
        drugPojo['brandName'] = drug;
        drugPojo['usageDirection'] = usage;
        drugPojo['remarks'] = si;
        drugPojo['drugType'] = drugType;
        console.log("drug type required is-------" + drugType);
        drugPojo['perServing'] = per_serving;
        var capsuleTypes = ['TABLET', 'CAPSULE', 'INJECTION', 'SACHET', 'LOZENGES', 'SUPPOSITORY', 'RESPULES', 'PEN', 'APLICAPS', 'ENEMA', 'PATCH'];
        if ($.inArray(drugType, capsuleTypes) !== -1) {
            if (days === 'Days') {
                drugPojo['noOfDays'] = units;
                drugPojo['quantity'] = parseInt(units) * quantCount * parseInt(per_serving);
            } else {
                drugPojo['quantity'] = units;
                drugPojo['noOfDays'] = quantCount != 0 ? parseInt(units) / (parseInt(per_serving) * quantCount) : 1;
            }
        } else {
            if (days === 'Days') {
                drugPojo['noOfDays'] = units;
                drugPojo['quantity'] = 1;
            } else {
                drugPojo['quantity'] = units;
                drugPojo['noOfDays'] = 1;
            }
        }

        console.log("drug pojo required is-----", drugPojo);

        console.log("drug usage is-----", usage);
        /*if (drug === "") {
            switch (drug) {
                case "":

                    swal({
                            title: "Error",
                            text: "Please select the drug",
                            type: "error",
                            confirmButtonText: "OK"
                        },
                        function() {}
                    );
                    break;
            }
        }*/

        /*check = ((usage === "") || (drug === ""));*/
        check = (drug === "");
        console.log("check value is---" + check);
        if (check) {
            switch (check) {
                case true:

                    swal({
                            title: "Error",
                            /*text: "Please enter drug details and select medicine usage timings",*/
                            text: "Please enter drug details",
                            type: "error",
                            confirmButtonText: "OK"
                        },
                        function() {}
                    );
                    break;
            }
        } else {
            //console.log("form submitted with values: "+drug+", "+days+", "+units+", "+si+", "+bbf+", "+abf+", "+bl+", "+al+", "+bd+", "+ad+", "+price+", "+constituents+", "+usage);
            $('#current-prescriptions > tbody').append('<tr ><td>' + count + '</td><td>' + drug + '</td><td>' + per_serving + " " + msrmnt + '</td><td>' + units + " " + days + '</td><td>' +
                usage + '</td><td>' + si + '</td><td id="deliD' + count + '"><button type="submit" name="delbtn" class="deletebutton" id="del' + count + '" value="delID' + count + '">Delete</button></td>');
            //$('#current-prescriptions').DataTable();
            //console.log($('#current-prescriptions').DataTable());
            $.cookie('drugHtml', $('#current-prescriptions > tbody').html());
            var countNum = Number(count);
            drugPojoList.push(drugPojo);
            console.log("drug pojo list required is------", drugPojoList);
            $.cookie('drugPojoList', JSON.stringify(drugPojoList));
            //console.log(JSON.stringify(drugPojoList));
            countNum++;
            $.cookie('drugEntryCount', countNum);
            formClear();
            $('#drugWarning').hide();
        }
    });



    $('#inputDatetxt').keyup(function(e) {

        var inputdays = $('#inputDatetxt').val();
        if (!isNaN(inputdays)) {
            daysToDate(inputdays);
        }

    });

    $('#prescription-book-appointment').click(function() {

        var patientInfoCookie = $.cookie('currentPatientInfo');
        var patientInfo = $.parseJSON(patientInfoCookie);
        //var scheduleTime = $('#inputDate').val();

        var dateString = $('#inputDate').val(); //"23/09/2014 - 09:15",
        var momentVar = moment($('#inputDate').val(), "DD/MM/YYYY");


        $.ajax({
            type: "POST",
            url: "http://localhost:8081/dbotica-spring/doctor/addCalendarEvent",
            beforeSend: function(xhr) {
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.setRequestHeader("Accept", "application/json");
            },
            xhrFields: {
                withCredentials: true
            },
            data: JSON.stringify({
                'patientId': patientInfo[0].id,
                'startTime': momentVar.valueOf() + 36000000,
                'label': patientInfo[0].firstName
            }),
            success: function(response) {
                var errorCode = response.errorCode;
                if (!!errorCode) {
                    switch (errorCode) {
                        case "NO_USER_LOGGED_IN":
                            localStorage.setItem("isLoggedIn", false);
                            swal({
                                    title: "Error",
                                    text: "You are not logged into your account. Kindly login again to view this page",
                                    type: "error",
                                    confirmButtonText: "OK",
                                    allowOutsideClick: true
                                },
                                function() {
                                    localStorage.setItem("isLoggedIn", false);
                                    window.location.href = "login.html";
                                }
                            );
                            break;
                    }
                }

                swal({
                    title: "Success",
                    text: "Appointment successfully booked",
                    type: "success",
                    confirmButtonText: "OK",
                    allowOutsideClick: true
                });

                var data = $.parseJSON(response.response);
                console.log(data);
                //Adding prescriptioninfo to indexedDB

                try {
                    addPrescriptionToIndexedDB(prescription, patientInfo[0], localStorage.getItem('doctorId'));
                } catch (e) {

                }
            },
            error: function(request, status, error) {
                swal({
                    title: "Error",
                    text: "Error updating the appointment details",
                    type: "error",
                    confirmButtonText: "OK",
                    allowOutsideClick: true
                });
            }



        });
    });


    $(document).on('click', '.deletebutton', function(e) {
        var result = confirm('Are you sure, you want to delete ?');
        console.log(this.id);


        if (result) {
            $.cookie('drugEntryCount', "");
            $.cookie('drugHtml', "");
            var id = this.id;
            id = id.slice(-1);
            id = id - 1;
            console.log(id);
            //alert(document.getElementById(id).value());
            var drugPojoList1 = $.cookie('drugPojoList');
            var drugData = JSON.parse(drugPojoList1);
            console.log(drugData);
            if (drugData.length != 0) {
                for (i in drugData) {
                    if (i == id) {
                        //alert(drugData[i]['perServing']);
                        var removedObject = drugData.splice(id, 1);
                        //alert('removedObject'+removedObject);
                        console.log('bye' + ' ' + i);
                        console.log(drugData);
                        break;

                    }
                }
            }
            var newCount = 1;
            $('#current-prescriptions > tbody').text("");
            drugPojoList = [];
            $.cookie('drugPojoList', "");

            for (s in drugData) {
                $('#current-prescriptions > tbody').append('<tr ><td>' + newCount + '</td><td>' + drugData[s]['brandName'] + '</td><td>' + drugData[s]['perServing'] + '</td><td>' + drugData[s]['noOfDays'] + '</td><td>' + drugData[s]['usageDirection'] + '</td><td>' + drugData[s]['remarks'] + '</td><td id="deliD' + newCount + '"><button type="submit" name="delbtn" class="deletebutton" id="del' + newCount + '" value="delID' + newCount + '">Delete</button></td>');
                newCount++;
                try {
                    drugPojoList.push(drugData[s]);

                } catch (e) {

                }


            }
            $.cookie('drugPojoList', JSON.stringify(drugPojoList));
            console.log('pushed');
            $.cookie('drugEntryCount', newCount);
            //$('#current-prescriptions').DataTable();
            //console.log($('#current-prescriptions').DataTable());
            $.cookie('drugHtml', $('#current-prescriptions > tbody').html());
        }
    });

    function OnGetDrugsResponse(data, callback) {
        var totalDrugObjects = [];
        //var dropdown = $('.drugs-dropdown-menu');
        //console.log("In OnGetDrugsResponse");
        if (data.length != 0) {
            for (var i = 0, l = data.length; i < l; i++) {
                totalDrugObjectsOnReady.push(data[i]);
                var drug = data[i];
                var brandNameString = drug['brandName'];
                if (drug['constituents']) {
                    brandNameString += " - "
                    var constituents = drug['constituents'];
                    for (var j in constituents) {

                        brandNameString += constituents[j]['molecule'] + " : " + constituents[j]['weight'] + ",";
                    }
                    brandNameString = brandNameString.slice(0, -1);
                }
                totalDrugObjects.push(brandNameString);


                /* dropdown.append('<li id="' + drug['id'] + '"><a href="#">' + string);*/
            }
            /*$('.drugs-dropdown-menu > li').click(function(e) {
                e.preventDefault();
                $('#prescription-form-information').css('display', 'none');
                $('#prescription-form-information-text').empty();
                var id = $(this).get(0).id;
                for (var s in data) {
                    if (data[s]['id'] === id) {
                        console.log(data[s]);
                        if (data[s]['price'])
                            if (data[s]['constituents']) {
                                var constituentsString = "";
                                var constituents = data[s]['constituents'];
                                for (var c in data[s]['constituents']) {
                                    constituentsString += constituents[c]['molecule'] + " : " + constituents[c]['weight'] + ",";
                                }
                                constituentsString = constituentsString.slice(0, -1);
                                $('#prescription-form-information-text').append("<li >constituents - <span id='prescription-form-constituents'>" + constituentsString + "</span></li>");
                                console.log("constituent strings are------" + constituentsString);
                            }
                        $('#prescription-form-information').css('display', 'block');

                        var drugSelected = data[s]['brandName'];

                        if (drugSelected !== "") {
                            var drugAllergyTo = $('#prescription-form-drug-allergy').val();
                            var drugAllergyToArray = [];
                            if (!!drugAllergyTo)
                                var drugAllergyToArray = drugAllergyTo.split(",");
                            var drugName = drugSelected.split(" (")[0];
                            var check;
                            for (var i = 0, l = drugAllergyToArray.length; i < l; i++) {
                                check = (drugName === drugAllergyToArray[i]);
                                if (check === true) {
                                    break;
                                } else {
                                    continue;
                                }

                            }
                            if (check) {
                                switch (check) {
                                    case true:

                                        swal({
                                                title: "Error",
                                                text: "Please select a drug to which patient is not allergic",
                                                type: "error",
                                                confirmButtonText: "OK",
                                                allowOutsideClick: true
                                            },
                                            function() {
                                                $('#prescription-form-drug').val("");
                                                $('#drugWarning').hide();
                                            }
                                        );

                                        break;
                                }

                            } else {
                                console.log("in else if");
                                $('#prescription-form-drug').val(data[s]['brandName']);
                                $('#prescription-form-drug').attr("drugId", data[s][id]);
                                $('#prescription-form-drug-type').text(data[s]['drugType']);
                                var drugTypeUpperCase = "" + data[s]['drugType'];
                                switch (drugTypeUpperCase.toUpperCase()) {
                                    case 'SYRUP':
                                        $('#prescription-form-measurmnt').text("ml");
                                        break;
                                    default:
                                        $('#prescription-form-measurmnt').text("units");
                                        break;


                                }
                                break;
                            }
                        }
                        break;
                    }
                }
                dropdown.hide('dropdown');

            });*/
            /*dropdown.show('dropdown');*/
        }
        /*console.log("total drug objects are-----", totalDrugObjects);*/
        callback(totalDrugObjects);
    }


    var delay = (function() {
        var timer = 0;
        return function(callback, ms) {
            clearTimeout(timer);
            timer = setTimeout(callback, ms);
        };
    })();


    /*$('#prescription-form-drug').keyup(function(e) {
        $('#drugWarning').show();
        var searchDrugChars = $('#prescription-form-drug').val();
        if (searchDrugChars === "") {
            $('#drugWarning').hide();
        }
        e.preventDefault();
        delay(prescriptionFormDrugCallback, 250);

    });*/

    var doctorCredits = localStorage.getItem('creditsOfDoctor');

    if (doctorCredits != "" && doctorCredits != null) {
        $('#creditsInSideBar').text(doctorCredits);
    }

    $('#prescription-form-drug').autocomplete({
        source: function(request, callback) {
            var searchParam = request.term;
            prescriptionFormDrugCallback(searchParam, callback)
        },
        minLength: 2,
        focus: function(event, ui) {
            event.preventDefault();
        },
        select: function(event, ui) {
            var drugSelected = "";
            console.log("drug objects are------", totalDrugObjectsOnReady);
            ui.item.value = ui.item.value.split(" -")[0];
            var drugIdSelected = 0;
            for (var drugIndex = 0; drugIndex < totalDrugObjectsOnReady.length; drugIndex++) {
                if (totalDrugObjectsOnReady[drugIndex]['brandName'] == ui.item.value) {
                    drugSelected = ui.item.value;
                    drugIdSelected = drugIndex;

                }
            }
            if (drugSelected !== "") {
                console.log("in not empty");
                var drugAllergyTo = $('#prescription-form-drug-allergy').val();
                var drugAllergyToArray = [];
                if (!!drugAllergyTo) {
                    console.log("indrugall");
                    var drugAllergyToArray = drugAllergyTo.split(",");
                    var drugName = drugSelected.split(" (")[0];
                    var check;
                    console.log("drugName is-----" + drugName);
                    for (var i = 0, l = drugAllergyToArray.length; i < l; i++) {
                        drugAllergyToArray[i] = drugAllergyToArray[i].toLowerCase();
                        check = (drugName === drugAllergyToArray[i]);
                        console.log("drug---" + drugAllergyToArray[i]);
                        console.log("checkis----", check);
                        if (check === true) {
                            break;
                        } else {
                            continue;
                        }

                    }
                    if (check) {
                        console.log("check value is--", check);
                        ui.item.value = "";
                        switch (check) {
                            case true:

                                swal({
                                        title: "Error",
                                        text: "Please select a drug to which patient is not allergic",
                                        type: "error",
                                        confirmButtonText: "OK"

                                    },
                                    function() {
                                        $('#prescription-form-drug').val("");
                                        /*$('#drugWarning').hide();*/
                                    }
                                );

                        }
                    }
                    $('#prescription-form-drug').attr("drugId", totalDrugObjectsOnReady[drugIdSelected]['id']);
                    $('#prescription-form-drug-type').text(totalDrugObjectsOnReady[drugIdSelected]['drugType']);
                    var drugTypeUpperCase = "" + totalDrugObjectsOnReady[drugIdSelected]['drugType'];
                    switch (drugTypeUpperCase.toUpperCase()) {
                        case 'SYRUP':
                            $('#prescription-form-measurmnt').text("ml");
                            break;
                        default:
                            $('#prescription-form-measurmnt').text("units");
                            break;
                    }

                } else {
                    $('#prescription-form-drug').attr("drugId", totalDrugObjectsOnReady[drugIdSelected]['id']);
                    $('#prescription-form-drug-type').text(totalDrugObjectsOnReady[drugIdSelected]['drugType']);
                    var drugTypeUpperCase = "" + totalDrugObjectsOnReady[drugIdSelected]['drugType'];
                    switch (drugTypeUpperCase.toUpperCase()) {
                        case 'SYRUP':
                            $('#prescription-form-measurmnt').text("ml");
                            break;
                        default:
                            $('#prescription-form-measurmnt').text("units");
                            break;
                    }

                }
            }


        }


    });

    var loadPatientReport = function() {
        window.location.href = 'patientReport.html';
    }

    $('#prescription-save-cont').click(function(e) {
        console.log("Prescription save cont started");

        var drugPojoListCookie = $.cookie('drugPojoList'); // Object
        var drugPojoList = [];
        if (!!drugPojoListCookie) {
            drugPojoList = JSON.parse(drugPojoListCookie);
        }
        var testPojoListCookie = $.cookie('testPojoList');
        var testPojoList = [];
        if (!!testPojoListCookie) {
            testPojoList = JSON.parse(testPojoListCookie);
        }

        /*$.cookie('currentPatientInfo-temp', $('#prescription-form-temp').val());
        $.cookie('currentPatientInfo-height', $('#prescription-form-height').val());
        $.cookie('currentPatientInfo-weight', $('#prescription-form-weight').val());
        $.cookie('currentPatientInfo-bloodPressure', $('#prescription-form-bloodPressure').val());
        $.cookie('currentPatientInfo-impression', $('#prescription-form-Symptoms').val());
        $.cookie('currentPatientInfo-pulse', $('#prescription-form-pulse').val());
        $.cookie('currentPatientInfo-saturation', $('#prescription-form-saturation').val());
        $.cookie('currentPatientInfo-bmi', $('#prescription-form-bmi').val());
        $.cookie('currentPrescriptionInfo-investigation', $('#prescription-form-Investigation').val());
        $.cookie('currentPrescriptionInfo-remarks', $('#prescription-form-remarks').val());
        $.cookie('currentPrescriptionInfo-referToDoctor', $('#referToDoctor').val());
        $.cookie('currentPatientInfo-drugAllergy', $('#prescription-form-drug-allergy').val());
        $.cookie('currentInputDate', $('#inputDate').val());
        $.cookie('currentInputDays', $('#inputDatetxt').val());
        var temperature = $.cookie('currentPatientInfo-temp');
        var height = $.cookie('currentPatientInfo-height');
        var weight = $.cookie('currentPatientInfo-weight');
        var bloodPressure = $.cookie('currentPatientInfo-bloodPressure');
        var impression = $.cookie('currentPatientInfo-impression');
        var bmi = $.cookie('currentPatientInfo-bmi');
        var saturation = $.cookie('currentPatientInfo-saturation');
        var pulse = $.cookie('currentPatientInfo-pulse');
        var investigation = $.cookie('currentPrescriptionInfo-investigation');
        var remarks = $.cookie('currentPrescriptionInfo-remarks');
        var revisitDate = $.cookie('currentInputDate');
        var revisitDays = $.cookie('currentInputDays');
        var referToDoctor = $.cookie('currentPrescriptionInfo-referToDoctor');*/

        var temperature = $('#prescription-form-temp').val();
        var height = $('#prescription-form-height').val();
        var weight = $('#prescription-form-weight').val();
        var bloodPressure = $('#prescription-form-bloodPressure').val();
        var symptoms = $('#prescription-form-Symptoms').val();
        var bmi = $('#prescription-form-bmi').val();
        var saturation = $('#prescription-form-saturation').val();
        var pulse = $('#prescription-form-pulse').val();
        var investigation = $('#prescription-form-Investigation').val();
        var remarks = $('#prescription-form-remarks').val();
        var revisitDate = $('#inputDate').val();
        var referToDoctor = $('#referToDoctor').val();

        var patientInfoCookie = $.cookie('currentPatientInfo');
        var patientInfo = $.parseJSON(patientInfoCookie);
        var prescriptionString = "";

        if (patientInfo == null) {
            console.log("Prescription save cont - No patient found");
            swal({
                title: "Update Patient Details",
                text: "Are you sure you want to update patient Details?",
                type: "info",
                showCancelButton: true,
                closeOnConfirm: false,
                showLoaderOnConfirm: true,
                allowOutsideClick: true
            }, function() {
                updatePatientDetails("savePrescription");
            });
            console.log("in return===");
            return;
        }

        console.log("patientInfoCookie", patientInfoCookie);
        var prescriptionCookie = $.cookie('currentPrescription');
        var prescription = {};
        if (!!prescriptionCookie) {

            prescription = JSON.parse(prescriptionCookie);

        }
        var today = getTodayString();


        console.log("remarks", remarks);
        if (!jQuery.isEmptyObject(prescription)) {
            prescription['patientId'] = patientInfo[0].id;
            prescription['doctorId'] = localStorage.getItem('doctorId');
            prescription['drugDosage'] = drugPojoList;
            prescription['diagnosisTests'] = testPojoList;
            prescription['remarks'] = remarks;
            prescription['height'] = height;
            prescription['weight'] = weight;
            prescription['bloodPressure'] = bloodPressure;
            prescription['temperature'] = temperature;
            prescription['age'] = patientInfo[0].age;
            prescription['gender'] = patientInfo[0].gender;
            prescription['bmi'] = bmi;
            prescription['saturation'] = saturation;
            prescription['pulse'] = pulse;
            prescription['investigation'] = investigation;
            prescription['revisitDate'] = (revisitDate !== today) ? revisitDate : "";
            prescription['references'] = referToDoctor;
            prescription['symptoms'] = symptoms;
            prescriptionString = JSON.stringify(prescription);
        } else {
            prescriptionString = JSON.stringify({
                'patientId': patientInfo[0].id,
                'doctorId': localStorage.getItem('doctorId'),
                'drugDosage': drugPojoList,
                'diagnosisTests': testPojoList,
                'remarks': remarks,
                'height': height,
                'weight': weight,
                'bloodPressure': bloodPressure,
                'temperature': temperature,
                'age': patientInfo[0].age,
                'gender': patientInfo[0].gender,
                'bmi': bmi,
                'saturation': saturation,
                'pulse': pulse,
                'investigation': investigation,
                'revisitDate': (revisitDate !== today) ? revisitDate : "",
                'references': referToDoctor,
                'symptoms': symptoms
            });
        }
        console.log("request entity for check is----", prescriptionString);

        var requestEntity = {};
        requestEntity.patientId = patientInfo[0].id;
        requestEntity.patientPhysicalDetails = {};
        requestEntity.patientPhysicalDetails.height = height;
        requestEntity.patientPhysicalDetails.weight = weight;
        requestEntity.patientPhysicalDetails.bloodPressure = bloodPressure;
        requestEntity.patientPhysicalDetails.updatedLocation = "entryPrescriptionPage";
        var time = new Date();
        time = time.getTime();
        requestEntity.patientPhysicalDetails.updatedDate = time;
        requestEntity = JSON.stringify(requestEntity);

        $.ajax({
            type: "POST",
            url: "http://localhost:8081/dbotica-spring/doctor/addPatientPhysicalDetails",
            beforeSend: function(xhr) {
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.setRequestHeader("Accept", "application/json");
            },
            xhrFields: {
                withCredentials: true
            },
            data: requestEntity,
            success: function(response) {
                var patientDetailsObject = {};
                try {
                    patientDetailsObject = $.parseJSON(response.response);
                } catch (e) {
                    console.log("Error in add physical Details from entry prescriptions");
                }
                console.log("patient object is----", patientDetailsObject);
            }
        });


        $.ajax({
            type: "POST",
            url: "http://localhost:8081/dbotica-spring/doctor/addMyPatients",
            beforeSend: function(xhr) {
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.setRequestHeader("Accept", "application/json");
            },
            xhrFields: {
                withCredentials: true
            },
            data: JSON.stringify({
                'patientId': patientInfo[0].id,
                'mobileNumber': patientInfo[0].phoneNumber
            }),
            success: function(response) {
                var errorCode = response.errorCode;
                if (!!errorCode) {
                    switch (errorCode) {
                        case "NO_USER_LOGGED_IN":
                            localStorage.setItem("isLoggedIn", false);
                            swal({
                                    title: "Error",
                                    text: "You are not logged into your account. Kindly login again to view this page",
                                    type: "error",
                                    confirmButtonText: "OK",
                                    allowOutsideClick: true
                                },
                                function() {
                                    localStorage.setItem("isLoggedIn", false);
                                    window.location.href = "login.html";
                                }
                            );
                            break;
                    }
                }

                console.log("addMyPatients  ", response);
            }
        });
        $.ajax({
            type: "POST",
            url: "http://localhost:8081/dbotica-spring/prescription/updatePrescription",
            beforeSend: function(xhr) {
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.setRequestHeader("Accept", "application/json");
            },
            xhrFields: {
                withCredentials: true
            },
            data: prescriptionString,
            success: function(response) {
                var errorCode = response.errorCode;
                if (!!errorCode) {
                    switch (errorCode) {
                        case "NO_USER_LOGGED_IN":
                            localStorage.setItem("isLoggedIn", false);
                            swal({
                                    title: "Error",
                                    text: "You are not logged into your account. Kindly login again to view this page",
                                    type: "error",
                                    confirmButtonText: "OK",
                                    allowOutsideClick: true
                                },
                                function() {
                                    localStorage.setItem("isLoggedIn", false);
                                    window.location.href = "login.html";
                                }
                            );
                            break;
                    }
                }
                swal({
                    title: "Success",
                    text: "Prescrition details are saved successfully",
                    type: "success",
                    confirmButtonText: "OK",
                    allowOutsideClick: true
                });

                var prescription = $.parseJSON(response.response);
                $.cookie('currentPrescription', response.response);

                try {
                    addPrescriptionToIndexedDB(prescription, patientInfo[0], localStorage.getItem('doctorId'), loadPatientReport);
                } catch (e) {}
            }
        });

    });

    $('prescription-form').submit(function(e) {
        var temp = $(this).serializeArray();
    });

    function resetAll() {
        $('#prescription-form-Symptoms').val("");
        $('#prescription-form-Investigation').val('');

        $('#current-prescriptions > tbody').empty();
        $('#current-tests > tbody').empty();
        $('#prescription-form-units').val('1');
        formClear();
        $.cookie('currentPrescription', "");
        $.cookie('newPatientPhoneNumber', "");
        $.cookie('drugHtml', "");
        $.cookie('drugEntryCount', "");
        $.cookie('testHtml', "");
        $.cookie('testEntryCount', "");
        $.cookie('currentPatientInfo', "");
        $.cookie('drugPojoList', "");
        $.cookie('testPojoList', "");
        $('#prescription-form-pd').find('input:text').val('');
        $('#prescription-form-test').val('');
        $('#prescription-form-test-remark').val('');


    }

    function removeCookies() {
        $.removeCookie('currentPrescription');
        $.removeCookie('newPatientPhoneNumber');
        $.removeCookie('drugHtml');
        $.removeCookie('drugEntryCount');
        $.removeCookie('testHtml');
        $.removeCookie('testEntryCount');
        $.removeCookie('currentPatientInfo');
        $.removeCookie('drugPojoList');
        $.removeCookie('testPojoList');
    }

    $('#prescription-reset').click(function(e) {
        resetAll();
        $('#inputDatetxt').val('');
        $('#inputDate').val('');
        $('#referToDoctor').val('');
        $('#prescription-form-remarks').val('');
        window.location.reload();
    });

    $('#prescription-reset-btm').click(function(e) {
        resetAll();
        window.location.reload();
    });

    $('prescription-form').submit(function(e) {
        var temp = $(this).serializeArray();
    });

    $('#prescription-form-height').keyup(function(e) {
        if ($('#prescription-form-weight').val() != '' && $('#prescription-form-height').val() != "") {
            var bmi = ($('#prescription-form-weight').val() * 10000) / ($('#prescription-form-height').val() * $('#prescription-form-height').val());
            bmi = Math.round(bmi * 100) / 100;
            $('#prescription-form-bmi').val(bmi);
        }

    });

    $('#prescription-form-weight').keyup(function(e) {
        if ($('#prescription-form-weight').val() != '' && $('#prescription-form-height').val() != "") {
            var bmi = ($('#prescription-form-weight').val() * 10000) / ($('#prescription-form-height').val() * $('#prescription-form-height').val());
            bmi = Math.round(bmi * 100) / 100;
            $('#prescription-form-bmi').val(bmi);
        }

    });

    function getTodayString() {
        var date = new Date();

        var day = date.getDate();
        var month = date.getMonth() + 1;
        var year = date.getFullYear();

        if (month < 10) month = "0" + month;
        if (day < 10) day = "0" + day;

        var today = day + "/" + month + "/" + year;

        return today;
    }


    $(document).ready(function() {
        $("#inputDate").datepicker({
            dateFormat: "dd/mm/yy",
            autoclose: true,
            'minDate': 0
        });

        var drugArrayAll = [];

        $('#medicinesModalBtn').click(function() {
            $.ajax({
                type: 'GET',
                url: "http://localhost:8081/dbotica-spring/doctor/getDrugTemplates",
                beforeSend: function(xhr) {
                    xhr.setRequestHeader("Content-Type", "application/json");
                    xhr.setRequestHeader("Accept", "application/json");
                },
                xhrFields: {
                    withCredentials: true
                },
                success: function(response) {
                    drugArrayAll = $.parseJSON(response.response);
                    console.log('get response is----', drugArrayAll);
                    $('#medicinesListModalBody').empty();
                    for (var drugIndex = 0; drugIndex < drugArrayAll.length; drugIndex++) {
                        if (drugArrayAll[drugIndex].state == 'ACTIVE') {
                            $('#medicinesListModalBody').append('<div class="row"><div class="col-md-1 col-sm-1 col-xs-1"><div class="checkbox"><label><input id="medicineCheckBox' + drugIndex + '" class="medicineCheckBox" type="checkbox" value=""></label></div></div><div class="col-md-3 col-sm-3 col-xs-3">' + drugArrayAll[drugIndex].drugDosage.brandName + '</div><div class="modalElements col-md-3 col-sm-12 col-xs-12"><label>Per Serving:</label><input id="perServingTxt' + drugIndex + '" placeholder="Per Serving"></div><div class=" modalElements col-md-offset-1 col-md-1 col-sm-12 col-xs-12"><label>Days/Quantity:</label><input id="unitsTxt' + drugIndex + '" placeholder="Days/Quantity"></div></div><div style="margin-top:5px;" class="row"><div usageDirInModal modalElements class="col-md-8 col-sm-12 col-xs-12"><label>Usage Directions:</label>' + drugArrayAll[drugIndex].drugDosage.usageDirection + '</div></div>');
                            $('#perServingTxt' + [drugIndex]).val(drugArrayAll[drugIndex].drugDosage.perServing);
                            $('#unitsTxt' + [drugIndex]).val(drugArrayAll[drugIndex].drugDosage.units);
                        }
                    }
                }
            });
        });

        $(document).on('click', '.medicineCheckBox', function(e) {
            var fullId = this.id;
            var idIndex = fullId.slice(-1);
            if ($('#medicineCheckBox' + [idIndex]).is(":checked")) {
                var drugObject = drugArrayAll[idIndex];
                console.log('drug object is---', drugObject);
                var drugPojo = {};
                drugPojo['drugId'] = drugObject.drugDosage.drugId;
                drugPojo['brandName'] = drugObject.drugDosage.brandName;
                drugPojo['usageDirection'] = drugObject.drugDosage.usageDirection;
                drugPojo['remarks'] = drugObject.drugDosage.remarks;
                drugPojo['drugType'] = drugObject.drugDosage.drugType;
                var per_serving = $('#perServingTxt' + [idIndex]).val();
                var units = $('#unitsTxt' + [idIndex]).val();
                console.log('per serving in is---', units);
                drugPojo['perServing'] = per_serving;
                var daysOrQuantity = drugObject.drugDosage.daysOrQuantity;
                var quantCount = 0;
                usageArray = drugObject.drugDosage.usageDirection.split(',');
                quantCount = usageArray.length;
                var capsuleTypes = ['TABLET', 'CAPSULE', 'INJECTION', 'SACHET', 'LOZENGES', 'SUPPOSITORY', 'RESPULES', 'PEN', 'APLICAPS', 'ENEMA', 'PATCH'];
                if ($.inArray(drugObject.drugDosage.drugType, capsuleTypes) !== -1) {
                    if (daysOrQuantity === 'Days') {
                        if (per_serving == undefined || per_serving == '' || per_serving == null) {
                            per_serving = parseInt(1);
                        }
                        if (quantCount == 0) {
                            quantCount = 1;
                        }
                        if (units == undefined || units == '' || units == null) {
                            units = parseInt(1);
                            drugPojo['noOfDays'] = units;
                            drugPojo['quantity'] = parseInt(units) * quantCount * parseInt(per_serving);
                        } else {
                            drugPojo['noOfDays'] = units;
                            drugPojo['quantity'] = parseInt(units) * quantCount * parseInt(per_serving);
                        }

                    } else {
                        drugPojo['quantity'] = units;
                        drugPojo['noOfDays'] = quantCount != 0 ? Math.ceil(parseInt(units) / (parseInt(per_serving) * quantCount)) : 1;
                    }
                } else {
                    if (daysOrQuantity === 'Days') {
                        drugPojo['noOfDays'] = units;
                        drugPojo['quantity'] = 1;
                    } else {
                        drugPojo['quantity'] = units;
                        drugPojo['noOfDays'] = 1;
                    }
                }
                var msrmnt;

                var count = $.cookie('drugEntryCount');
                if (!count) {
                    count = 1;
                }

                var drugPojoList = [];
                if ($.cookie('drugPojoList') && $.cookie('drugPojoList') !== "") {
                    drugPojoList = $.parseJSON($.cookie('drugPojoList'));
                }

                switch (drugObject.drugDosage.drugType.toUpperCase()) {
                    case 'SYRUP':
                        msrmnt = 'ml';
                        break;
                    default:
                        msrmnt = 'units';
                        break;
                }

                $('#current-prescriptions > tbody').append('<tr ><td>' + count + '</td><td>' + drugObject.drugDosage.brandName + '</td><td>' + per_serving + " " + msrmnt + '</td><td>' + units + " " + daysOrQuantity + '</td><td>' +
                    drugObject.drugDosage.usageDirection + '</td><td>' + drugObject.drugDosage.remarks + '</td><td id="deliD' + count + '"><button type="submit" name="delbtn" class="deletebutton" id="del' + count + '" value="delID' + count + '">Delete</button></td>');
                //$('#current-prescriptions').DataTable();
                //console.log($('#current-prescriptions').DataTable());
                $.cookie('drugHtml', $('#current-prescriptions > tbody').html());
                var countNum = Number(count);
                drugPojoList.push(drugPojo);
                console.log("drug pojo list required is------", drugPojoList);
                $.cookie('drugPojoList', JSON.stringify(drugPojoList));
                //console.log(JSON.stringify(drugPojoList));
                countNum++;
                $.cookie('drugEntryCount', countNum);

            } else {
                console.log('in not checked----');
            }
        });




        /*var totalDrugObjectsOnReady;*/
        /*setInterval(function() {*/

        /*old part start*/

        //$.cookie('currentPatientInfo', "");

        /*
        console.log("check value is----", check);
        if (check === 'false') {
            console.log("in check");
            window.location.href = "login.html";
        }*/
        $('#prescription-form-patient-name').val("");
        $('#prescription-form-drug-allergy').val("");
        var doctorIdActive = $.cookie('doctorCurrentlyLoggedInId');
        var patientsListOfThatDoctorParsed = [];
        $('.patientsListToBeDisplayed').remove();
        $('.appointmentsPatientsList').remove();
        $('.walkinPatientsList').remove();

        console.log("doctor id in getPatientsListOfDoctor---" + doctorIdActive);
        var patientsList = [];
        $.ajax({
            type: "GET",
            url: "http://localhost:8081/dbotica-spring/assistant/getDoctorEvents?doctorId=" + doctorIdActive,
            beforeSend: function(xhr) {
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.setRequestHeader("Accept", "application/json");
            },
            xhrFields: {
                withCredentials: true
            },
            async: false,
            success: function(response) {
                console.log("patients list of doctor in entry prescription----", response);
                var errorCode = response.errorCode;
                console.log("error code is----" + errorCode);
                if (!!errorCode) {
                    switch (errorCode) {
                        case "NO_USER_LOGGED_IN":
                            localStorage.setItem("isLoggedIn", false);
                            swal({
                                    title: "Error",
                                    text: "You are not logged into your account. Kindly login again to view this page",
                                    type: "error",
                                    confirmButtonText: "OK",
                                    allowOutsideClick: true
                                },
                                function() {
                                    localStorage.clear();
                                    removeCookies();
                                    localStorage.setItem("isLoggedIn", false);
                                    window.location.href = "login.html";
                                }
                            );
                            break;
                    }
                }

                patientsListOfThatDoctorParsed = JSON.parse(response.response);
                console.log("list of patients in entry prescription---", patientsListOfThatDoctorParsed);
            }
        });
        var patientsListOfThatDoctor = [];
        var appointmentsPatientsListOfThatDoctor = [];
        var appointmentsPatientsIdListOfThatDocotor = [];
        var walkinPatientsIdListOfThatDoctor = [];
        var walkinPatientsListOfThatDoctor = [];
        var totalNumberOfPatients = patientsListOfThatDoctorParsed.length;
        $('.sidebar-menu').append('<div class="patientsListToBeDisplayed"></div>');
        $('.patientsListToBeDisplayed').append('<label class="appointmentsLabel">Patients : ' + totalNumberOfPatients + '</label><br>');
        $('.patientsListToBeDisplayed').append('<label class="appointmentsLabel">Appointments :</label><ul class="appointmentsPatientsList"></ul>');
        for (var s in patientsListOfThatDoctorParsed) {
            console.log("label value is----" + patientsListOfThatDoctorParsed[s]);
            if (patientsListOfThatDoctorParsed[s]['calendarStatus'] === "APPOINTMENT") {
                appointmentsPatientsListOfThatDoctor.push(patientsListOfThatDoctorParsed[s]);
            } else {
                walkinPatientsListOfThatDoctor.push(patientsListOfThatDoctorParsed[s]);
            }
        }
        for (var s in appointmentsPatientsListOfThatDoctor) {
            appointmentsPatientsIdListOfThatDocotor.push(appointmentsPatientsListOfThatDoctor[s]['patientId']);
            var millisecsOfThatPatient = appointmentsPatientsListOfThatDoctor[s]['startTime'];
            var date = new Date(millisecsOfThatPatient);
            timeString = date.toLocaleString('en-US', {
                hour12: true
            });
            var timeArray = timeString.split(",");
            var timeInHrMin = timeArray[1].split(":");
            var amOrPm = timeInHrMin[2].split(" ");
            var timeOfPatient = timeInHrMin[0] + ":" + timeInHrMin[1] + " " + amOrPm[1];

            if (appointmentsPatientsListOfThatDoctor[s]['state'] === 'INACTIVE') {
                continue;
            } else {
                $('.appointmentsPatientsList').append('<li id="appointment' + s + '" class="patientName" style="margin-left:10px;">' + appointmentsPatientsListOfThatDoctor[s]['label'] + '-' + timeOfPatient + '</li>');
            }
        }
        var appointmentsIds = [];
        appointmentsIds = JSON.stringify(appointmentsPatientsIdListOfThatDocotor);
        $.cookie('appointmentsIdFullList', appointmentsIds);
        $('.patientsListToBeDisplayed').append('<label class="appointmentsLabel">WalkIn :</label><ul class="walkinPatientsList"></ul>');
        for (var s in walkinPatientsListOfThatDoctor) {
            walkinPatientsIdListOfThatDoctor.push(walkinPatientsListOfThatDoctor[s]['patientId']);
            if (walkinPatientsListOfThatDoctor[s]['state'] === 'INACTIVE') {
                continue;
            } else {
                $('.walkinPatientsList').append('<li id="walkin' + s + '" class="patientName" style="margin-left:10px;">' + walkinPatientsListOfThatDoctor[s]['label'] + '</li>');
            }
        }
        var walkinsIds = [];
        walkinsIds = JSON.stringify(walkinPatientsIdListOfThatDoctor);
        $.cookie('walkinsIdFullList', walkinsIds);

        /*old part End*/


        /*New Part Start*/


        /*$.cookie('currentPatientInfo', "");
        var doctorIdActive = $.cookie('doctorCurrentlyLoggedInId');
        var patientsListOfThatDoctorParsed = [];
        $('.patientsListToBeDisplayed').remove();
        $('.appointmentsPatientsList').remove();
        $('.walkinPatientsList').remove();

        console.log("doctor id in getPatientsListOfDoctor---" + doctorIdActive);
        var patientsList = [];
        $.ajax({
            type: "GET",
            url: "http://localhost:8081/dbotica-spring/assistant/getDoctorEvents?doctorId=" + doctorIdActive,
            beforeSend: function(xhr) {
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.setRequestHeader("Accept", "application/json");
            },
            xhrFields: {
                withCredentials: true
            },
            success: function(response) {
                console.log("patients list of doctor in entry prescription----", response);
                patientsListOfThatDoctorParsed = JSON.parse(response.response);
                console.log("list of patients in entry prescription---", patientsListOfThatDoctorParsed);
                appointmentsAndWalkinsList(patientsListOfThatDoctorParsed);
            }

        });*/


        /*New Part End*/
        /*}, 5000);*/

        $('.appointmentsPatientsList').on('click', '.patientName', function(e) {
            console.log("in appointments list------");
            var appointmentsIdValues = $.cookie('appointmentsIdFullList');
            var appointmentsIdParsed = JSON.parse(appointmentsIdValues);

            var idNumber = this.id.slice(-1);
            var appointmentId = appointmentsIdParsed[idNumber];
            console.log("appointment id of patient clicked---" + appointmentId);

            $.ajax({
                type: "GET",
                url: "http://localhost:8081/dbotica-spring/doctor/getPatients?patientIds=" + appointmentId,
                beforeSend: function(xhr) {
                    xhr.setRequestHeader("Content-Type", "application/json");
                    xhr.setRequestHeader("Accept", "application/json");
                },
                xhrFields: {
                    withCredentials: true
                },
                success: function(response) {
                    if (response.success === true && response.response.length > 2) {
                        var data1 = $.parseJSON(response.response);
                        console.log(" response in appointment list response is---" + response.response);
                        $.cookie('currentPatientInfo', response.response);
                        $('#patient-search-result').load('registerPatient.html');
                        console.log("id of patient recived ", data1[0]);
                        try {
                            addPatientObjecttoIndexedDB(data1[0]);
                        } catch (e) {

                        }
                    }
                    updatePatientFields();

                }
            });

        });

        $('.walkinPatientsList').on('click', '.patientName', function() {
            var walkinsIdValues = $.cookie('walkinsIdFullList');
            var walkinsIdParsed = JSON.parse(walkinsIdValues);

            var idNumber = this.id.slice(-1);
            var walkinId = walkinsIdParsed[idNumber];
            console.log("appointment id of patient clicked---" + walkinId);

            $.ajax({
                type: "GET",
                url: "http://localhost:8081/dbotica-spring/doctor/getPatients?patientIds=" + walkinId,
                beforeSend: function(xhr) {
                    xhr.setRequestHeader("Content-Type", "application/json");
                    xhr.setRequestHeader("Accept", "application/json");
                },
                xhrFields: {
                    withCredentials: true
                },
                success: function(response) {
                    if (response.success === true && response.response.length > 2) {
                        var data1 = $.parseJSON(response.response);
                        console.log(" response in appointment list response is---" + response.response);
                        $.cookie('currentPatientInfo', response.response);
                        $('#patient-search-result').load('registerPatient.html');
                        console.log("id of patient recived ", data1[0]);
                        try {
                            addPatientObjecttoIndexedDB(data1[0]);
                        } catch (e) {

                        }
                    }
                    updatePatientFields();

                }
            });

        });



        $('#searchclear').click(function() {
            $('.drugs-dropdown-menu').hide();
            $("#drugWarning").hide();
            $("#prescription-form-drug").val("");
            $("#prescription-form-drug-type").text("");
            $('#prescription-form-information-text').hide();
        });
        $('#drugWarning').hide();
        if (localStorage.getItem("isLoggedIn") == "false") {
            window.location.href = "login.html";
        }

        var doctorName = localStorage.getItem('firstName');
        console.log("doctor name is----" + doctorName);
        $("#doctorName").text(doctorName);
        doctorName = "Dr. " + doctorName;
        $("#doctorNameInTheHeader").text(doctorName);
        $("#doctorNameInSideBar").text(doctorName);

        /*$(window).scroll(function() {
            var sticky = $('.fixed-content'),
                scroll = $(window).scrollTop();

            if (scroll > 1) sticky.addClass('fixed');
            else sticky.removeClass('fixed');
        });*/

        $('#closeOnSelect').hide();

        document.getElementById('inputDate').value = getTodayString();

        //Prescription form filling from cookie

        var prescriptionCookie = $.cookie('currentPrescription');
        var prescription = {};
        if (!!prescriptionCookie) {

            prescription = JSON.parse(prescriptionCookie);

        }
        console.log("prescription ready ", prescription);
        var temperature = prescription['temperature'];
        var height = prescription['height'];
        var weight = prescription['weight'];
        var bloodPressure = prescription['bloodPressure'];
        var symptoms = prescription['symptoms'];
        var bmi = prescription['bmi'];
        var saturation = prescription['saturation'];
        var pulse = prescription['pulse'];
        var investigation = prescription['investigation'];
        var finalRemarks = prescription['remarks'];
        var revisitDate = prescription['revisitDate'];
        var referToDoctor = prescription['references'];

        if (symptoms && symptoms.length != 0) {
            $('#prescription-form-Symptoms').val(symptoms);
        }

        if (investigation && investigation.length != 0) {
            $('#prescription-form-Investigation').val(investigation);

        }

        if (temperature && temperature.length != 0) {
            $('#prescription-form-temp').val(temperature);
        }

        if (height && height.length != 0) {
            $('#prescription-form-height').val(height);
        }

        if (weight && weight.length != 0) {
            $('#prescription-form-weight').val(weight);
        }

        if (bloodPressure && bloodPressure.length != 0) {
            $('#prescription-form-bloodPressure').val(bloodPressure);
        }

        if (bmi && bmi.length != 0) {
            $('#prescription-form-bmi').val(bmi);
        }


        if (saturation && saturation.length != 0) {
            $('#prescription-form-saturation').val(saturation);
        }


        if (pulse && pulse.length != 0) {
            $('#prescription-form-pulse').val(pulse);
        }

        if (referToDoctor && referToDoctor.length != 0) {
            $('#referToDoctor').val(referToDoctor);
        }

        if (finalRemarks && finalRemarks.length != 0) {
            $('#prescription-form-remarks').val(finalRemarks);
        }

        if (revisitDate && revisitDate.length != 0) {
            $('#inputDate').val(revisitDate);
        }




        updatePatientFields();

        var phoneNumberSearch = getQueryStringValue("phoneNumber");
        var patientIdOfThePatient = getQueryStringValue("patientId");
        console.log("phone number while searching----" + phoneNumberSearch);
        console.log("patient id while searching is----" + patientIdOfThePatient);
        if (patientIdOfThePatient !== "") {
            console.log("in query if----");
            phoneNumberSearch = patientIdOfThePatient;
        }
        if (phoneNumberSearch !== "") {
            console.log("in second if----");
            $('#patientSearchAside').hide();
            $('#patient-search-result').text('');

            resetAll();
            var uniId = $("#patient-search-uniqueid").val();
            $.ajax({
                type: "GET",
                url: "http://localhost:8081/dbotica-spring/doctor/getPatients",
                data: {
                    'patientIds': phoneNumberSearch
                },
                xhrFields: {
                    withCredentials: true
                },
                success: function(response) {
                    console.log("first page response is----", response);
                    var errorCode = response.errorCode;
                    console.log("error code is----" + errorCode);
                    if (!!errorCode) {
                        switch (errorCode) {
                            case "NO_USER_LOGGED_IN":
                                localStorage.setItem("isLoggedIn", false);
                                swal({
                                        title: "Error",
                                        text: "You are not logged into your account. Kindly login again to view this page",
                                        type: "error",
                                        confirmButtonText: "OK",
                                        allowOutsideClick: true
                                    },
                                    function() {
                                        localStorage.setItem("isLoggedIn", false);
                                        window.location.href = "login.html";
                                    }
                                );
                                break;
                        }
                    }

                    if (response.success === true && response.response.length > 2) {
                        var data1 = $.parseJSON(response.response);
                        console.log(" response response is---" + response.response);
                        $.cookie('currentPatientInfo', response.response);
                        $('#patient-search-result').load('registerPatient.html');
                        console.log("id of patient recived ", data1[0]);
                        try {
                            addPatientObjecttoIndexedDB(data1[0]);
                        } catch (e) {

                        }
                    } else {
                        swal({
                            title: "Info",
                            text: "No details found for this patient",
                            type: "info",
                            confirmButtonText: "OK",
                            allowOutsideClick: true
                        });
                        var num = [];
                        $.cookie('currentPatientInfo', null);
                        $.cookie('newPatientPhoneNumber', phoneNumberSearch);
                        $('#patient-search-result').load('registerPatient.html');

                    }
                    updatePatientFields();
                }
            });
        }


        $('#current-prescriptions > tbody').append($.cookie('drugHtml'));
        //$('#current-prescriptions').DataTable();
        $('#current-tests > tbody').append($.cookie('testHtml'));

        //var patntPhn = $('#patient-search-telephone').val();
        //$.cookie('patientPhnCk',patntPhn);

        $('#logoutButton').click(function(e) {
            $.ajax({
                type: "POST",
                url: "http://localhost:8081/dbotica-spring/doctor/logout",
                beforeSend: function(xhr) {
                    xhr.setRequestHeader("Content-Type", "application/json");
                    xhr.setRequestHeader("Accept", "application/json");
                },
                xhrFields: {
                    withCredentials: true
                },
                success: function(response) {
                    localStorage.clear();
                    removeCookies();
                    localStorage.setItem("isLoggedIn", false);
                    window.location.href = "login.html";
                },
                error: function() {
                    localStorage.clear();
                    removeCookies();
                    localStorage.setItem("isLoggedIn", false);
                    window.location.href = "login.html";
                }
            });
        });



    });

    /*New Part Function Dont Delete*/

    /*var appointmentsAndWalkinsList = function(parsedArray) {
        var date = new Date();
        var millisecondsOfPresentTime = date.getTime();
        var millisecondsOfNextTwoHours = millisecondsOfPresentTime + (2 * 60 * 60 * 1000);
        var patientsListOfThatDoctor = [];
        var appointmentsPatientsListOfThatDoctor = [];
        var appointmentsPatientsIdListOfThatDocotor = [];
        var walkinPatientsIdListOfThatDoctor = [];
        var walkinPatientsListOfThatDoctor = [];
        var totalNumberOfPatients = parsedArray.length;
        $('.sidebar-menu').append('<div class="patientsListToBeDisplayed"></div>');
        $('.patientsListToBeDisplayed').append('<label class="appointmentsLabel">Patients : ' + totalNumberOfPatients + '</label><br>');
        $('.patientsListToBeDisplayed').append('<label class="appointmentsLabel">Appointments :</label><ul class="appointmentsPatientsList"></ul>');
        for (var s in parsedArray) {
            console.log("label value is----" + parsedArray[s]);
            if (parsedArray[s]['calendarStatus'] === "APPOINTMENT") {
                appointmentsPatientsListOfThatDoctor.push(parsedArray[s]);
            } else {
                walkinPatientsListOfThatDoctor.push(parsedArray[s]);
            }
        }
        for (var s in appointmentsPatientsListOfThatDoctor) {
            appointmentsPatientsIdListOfThatDocotor.push(appointmentsPatientsListOfThatDoctor[s]['patientId']);
            var millisecsOfThatPatient = appointmentsPatientsListOfThatDoctor[s]['startTime'];
            var date = new Date(millisecsOfThatPatient);
            timeString = date.toLocaleString('en-US', {
                hour12: true
            });
            var timeArray = timeString.split(",");
            var timeInHrMin = timeArray[1].split(":");
            var amOrPm = timeInHrMin[2].split(" ");
            var timeOfPatient = timeInHrMin[0] + ":" + timeInHrMin[1] + " " + amOrPm[1];

            if (appointmentsPatientsListOfThatDoctor[s]['state'] === 'INACTIVE') {
                continue;
            } else {
                if (millisecsOfThatPatient <= millisecondsOfNextTwoHours) {
                    $('.appointmentsPatientsList').append('<li id="appointment' + s + '" class="patientName" style="margin-left:10px;">' + appointmentsPatientsListOfThatDoctor[s]['label'] + '-' + timeOfPatient + '</li>');
                }
            }
        }
        var appointmentsIds = [];
        appointmentsIds = JSON.stringify(appointmentsPatientsIdListOfThatDocotor);
        $.cookie('appointmentsIdFullList', appointmentsIds);
        $('.patientsListToBeDisplayed').append('<label class="appointmentsLabel">WalkIn :</label><ul class="walkinPatientsList"></ul>');
        for (var s in walkinPatientsListOfThatDoctor) {
            walkinPatientsIdListOfThatDoctor.push(walkinPatientsListOfThatDoctor[s]['patientId']);
            if (walkinPatientsListOfThatDoctor[s]['state'] === 'INACTIVE') {
                continue;
            } else {
                $('.walkinPatientsList').append('<li id="walkin' + s + '" class="patientName" style="margin-left:10px;">' + walkinPatientsListOfThatDoctor[s]['label'] + '</li>');
            }
        }
        var walkinsIds = [];
        walkinsIds = JSON.stringify(walkinPatientsIdListOfThatDoctor);
        $.cookie('walkinsIdFullList', walkinsIds);
    }*/

    /*New Part Function End Dont Delete*/
    </script>
    <script>
    function daysToDate(days) {

        var date = new Date();
        var newDate = new Date(date.getTime() + days * 24 * 60 * 60 * 1000);

        console.log(newDate);
        var day = newDate.getDate();
        var month = Number(newDate.getMonth()) + 1;
        var year = newDate.getFullYear();
        if (month < 10) month = "0" + month;
        if (day < 10) day = "0" + day;

        var revisitDate = day + "/" + month + "/" + year;
        document.getElementById('inputDate').value = revisitDate;
    }

    function formClear() {

        $('#prescription-form').find('input:text').val('');
        $('#prescription-form').find('input:button').removeClass('btn-success').addClass('btn-default');
        $('#prescription-form-information').css('display', 'none');
        $('#prescription-form-information-text').empty();
        //$('#prescription-form-units').val('1');
        $('#prescription-form-drug-type').html('');
        $('#prescription-form-measurmnt').html('units');
        $('#prescription-form-si').val('');
        //console.log('claered');

    }
    </script>
    <script>
    $('#patient-search').click(function(e) {
        e.preventDefault();
        var phoneNumberSearch;
        phoneNumberSearch = $('#patient-search-telephone').val();
        console.log("phone number while searching----" + phoneNumberSearch);
        if (phoneNumberSearch !== "") {
            $('#patientSearchAside').hide();
            $('#patient-search-result').text('');

            resetAll();
            var uniId = $("#patient-search-uniqueid").val();
            var phn = $("#patient-search-telephone").val();


            $.ajax({
                type: "GET",
                url: "http://localhost:8081/dbotica-spring/doctor/getPatients",
                data: {
                    'patientIds': phn
                },
                xhrFields: {
                    withCredentials: true
                },
                success: function(response) {
                    console.log("first page response is----", response);
                    var errorCode = response.errorCode;
                    console.log("error code is----" + errorCode);
                    if (!!errorCode) {
                        switch (errorCode) {
                            case "NO_USER_LOGGED_IN":
                                localStorage.setItem("isLoggedIn", false);
                                swal({
                                        title: "Error",
                                        text: "You are not logged into your account. Kindly login again to view this page",
                                        type: "error",
                                        confirmButtonText: "OK",
                                        allowOutsideClick: true
                                    },
                                    function() {
                                        localStorage.setItem("isLoggedIn", false);
                                        console.log("Redirecting to login page");
                                        window.location.href = "login.html";
                                    }
                                );
                                break;
                        }
                    }

                    if (response.success === true && response.response.length > 2) {
                        var data1 = $.parseJSON(response.response);
                        console.log(" response response is---" + response.response);
                        var data2 = data1.slice(0, 8);
                        $.cookie('currentPatientInfo', JSON.stringify(data2));
                        $('#patient-search-result').load('registerPatient.html');
                        console.log("id of patient recived ", data1[0]);
                        try {
                            addPatientObjecttoIndexedDB(data1[0]);
                        } catch (e) {

                        }
                    } else {
                        swal({
                            title: "Info",
                            text: "No details found for this patient",
                            type: "info",
                            confirmButtonText: "OK",
                            allowOutsideClick: true
                        });
                        var num = [];
                        $.cookie('currentPatientInfo', null);
                        $.cookie('newPatientPhoneNumber', phn);
                        $('#patient-search-result').load('registerPatient.html');

                        // $("patient-search-result").append('<input type="button" id="prescription-form-BBF" class="prescription-form-toggle-buttons col-md-1 btn btn-default btn-xs" value="BBF"></input>');
                    }
                    updatePatientFields();
                }
            });
        } else {
            swal({
                title: "Error",
                text: "Please enter mobile number before search",
                type: "error",
                confirmButtonText: "OK",
                allowOutsideClick: true
            });
        }

    });

    function updatePatientFields() {

        var currentPatientInfoList = $.cookie('currentPatientInfo');
        console.log("in up---", currentPatientInfoList);
        var data1 = [];

        if (!!currentPatientInfoList && currentPatientInfoList !== 'null') {
            data1 = $.parseJSON(currentPatientInfoList);
        }

        if (data1.length != 0) {
            /*console.log("last is---",data1[0]['lastName']);*/
            var lastName = data1[0]['lastName'];
            if (lastName === undefined || lastName.length <= 0) {
                lastName = "";
            }

            try {
                $('#prescription-form-patient-name').text(data1[0]['firstName'] + " " + lastName);
                $('#prescription-form-drug-allergy').val(data1[0]['drugAllergy']);
            } catch (e) {

            }
        }
    }

    function getQueryStringValue(key) {
        return unescape(window.location.search.replace(new RegExp("^(?:.*[&\\?]" + escape(key).replace(/[\.\+\*]/g, "\\$&") + "(?:\\=([^&]*))?)?.*$", "i"), "$1"));
    }



    /*$('.appointmentsPatientsList').on('click', '.patientName', function(e) {
        console.log("in appointments list------");
        var appointmentsIdValues = $.cookie('appointmentsIdFullList');
        var appointmentsIdParsed = JSON.parse(appointmentsIdValues);

        var idNumber = this.id.slice(-1);
        var appointmentId = appointmentsIdParsed[idNumber];
        console.log("appointment id of patient clicked---" + appointmentId);

        $.ajax({
            type: "GET",
            url: "http://localhost:8081/dbotica-spring/doctor/getPatients?patientIds=" + appointmentId,
            beforeSend: function(xhr) {
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.setRequestHeader("Accept", "application/json");
            },
            xhrFields: {
                withCredentials: true
            },
            success: function(response) {
                if (response.success === true && response.response.length > 2) {
                    var data1 = $.parseJSON(response.response);
                    console.log(" response in appointment list response is---" + response.response);
                    $.cookie('currentPatientInfo', response.response);
                    $('#patient-search-result').load('registerPatient.html');
                    console.log("id of patient recived ", data1[0]);
                    try {
                        addPatientObjecttoIndexedDB(data1[0]);
                    } catch (e) {

                    }
                }
                updatePatientFields();

            }
        });

    });

    $('.walkinPatientsList').on('click', '.patientName', function() {
        var walkinsIdValues = $.cookie('walkinsIdFullList');
        var walkinsIdParsed = JSON.parse(walkinsIdValues);

        var idNumber = this.id.slice(-1);
        var walkinId = walkinsIdParsed[idNumber];
        console.log("appointment id of patient clicked---" + walkinId);

        $.ajax({
            type: "GET",
            url: "http://localhost:8081/dbotica-spring/doctor/getPatients?patientIds=" + walkinId,
            beforeSend: function(xhr) {
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.setRequestHeader("Accept", "application/json");
            },
            xhrFields: {
                withCredentials: true
            },
            success: function(response) {
                if (response.success === true && response.response.length > 2) {
                    var data1 = $.parseJSON(response.response);
                    console.log(" response in appointment list response is---" + response.response);
                    $.cookie('currentPatientInfo', response.response);
                    $('#patient-search-result').load('registerPatient.html');
                    console.log("id of patient recived ", data1[0]);
                    try {
                        addPatientObjecttoIndexedDB(data1[0]);
                    } catch (e) {

                    }
                }
                updatePatientFields();

            }
        });

    });*/
    </script>
    <!--  <script type="text/javascript">
  $("#modal_trigger").leanModal({top : 200, overlay : 0.6, closeButton: ".modal_close" });

  $(function(){
    // Calling Login Form
    $("#login_form").click(function(){
      $(".social_login").hide();
      $(".user_login").show();
      return false;
    });

    // Calling Register Form
    $("#register_form").click(function(){
      $(".social_login").hide();
      $(".user_register").show();
      $(".header_title").text('Register');
      return false;
    });

    // Going back to Social Forms
    $(".back_btn").click(function(){
      $(".user_login").hide();
      $(".user_register").hide();
      $(".social_login").show();
      $(".header_title").text('Login');
      return false;
    });

  })
</script> -->
    </script>
    <!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>-->
    <script src="js/jquery.form-validator.min.js"></script>
    <script>
    $.validate();
    </script>
    <script type="text/javascript">
    function prescriptionFormDrugCallback(brandName, callback) {
        var drugObject = {};
        //var brandName = $('#prescription-form-drug').val();
        if (brandName === "") {
            $('.drugs-dropdown-menu').hide('dropdown');
            return;
        }

        /*$('.drugs-dropdown-menu').hide('dropdown');
        $('.drugs-dropdown-menu').empty();*/

        autocompleteDrugIndexedDB(brandName, '#prescription-form-drug', OnGetDrugsResponse, callback);


        /*autocompleteDrugIndexedDB(brandName, '#prescription-form-drug');*/
        /*$.ajax({
            type: "GET",
            url: "http://localhost:8081/dbotica-spring/drug/getDrugs",
            data: {
                'brandName': brandName
            },
            xhrFields: {
                withCredentials: true
            },
            success: function(response) {
              var errorCode = response.errorCode;
                if (!!errorCode) {
                    switch (errorCode) {
                        case "NO_USER_LOGGED_IN":
                            localStorage.setItem("isLoggedIn", false);
                            swal({
                                    title: "Error",
                                    text: "You are not logged into your account. Kindly login again to view this page",
                                    type: "error",
                                    confirmButtonText: "OK"
                                },
                                function() {
                                    localStorage.setItem("isLoggedIn", false);
                                    window.location.href = "login.html";
                                }
                            );
                            break;
                    }
                }

                if (brandName === $('#prescription-form-drug').val()) {
                    var data = $.parseJSON(response.response);
                    console.log(data);
                    OnGetDrugsResponse(data);

                }
            }
        });*/
    }
    </script>
</body>

</html>
