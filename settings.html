<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>dbotica</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.3.5 -->
    <link href="css/jquery-ui.css" rel="stylesheet">
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="//code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="dist/css/AdminLTE.css">
    <!-- AdminLTE Skins. Choose a skin from the css/skins
    folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" href="dist/css/skins/_all-skins.min.css">
    <link rel="stylesheet" href="entryPrescription.css">
    <link rel="stylesheet" type="text/css" href="settings.css">
    <style type="text/css">
    .ui-autocomplete {
        z-index: 5000;
    }
    </style>
    <!--Datepicker srcs 
    <link rel="stylesheet" href="css/datepicker.css" type="text/css" />-->
    <script src="plugins/jQuery/jquery-1.9.1.js"></script>
    <link rel="stylesheet" type="text/css" href="bootstrap/css/jquery.jscrollpane.css">
    <script type="text/javascript" src="bootstrap/js/jquery.mousewheel.js"></script>
    <script type="text/javascript" src="bootstrap/js/jquery.jscrollpane.min.js"></script>
    <script type="text/javascript" src="js/sketch.js"></script>
    <script type="text/javascript">
    $.holdReady(true);
    if (localStorage.getItem('isLoggedIn') === 'true') {
        $.holdReady(false);
    } else {
        window.location.href = 'login.html';
    }
    </script>
    <!--  <link rel="stylesheet" media="screen" type="text/css" href="css/layout.css" />
    <script type="text/javascript" src="js/datepicker.js"></script>
    <script type="text/javascript" src="js/layout.js?ver=1.0.2"></script>-->
    <script src="js/jquery-ui.js"></script>
    <script type="text/javascript" src="js/eye.js"></script>
    <script type="text/javascript" src="js/utils.js"></script>
    <script src="plugins/sweetalert/dist/sweetalert.min.js"></script>
    <link rel="stylesheet" type="text/css" href="plugins/sweetalert/dist/sweetalert.css">
    <script src="js/moment.min.js"></script>
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
</head>

<body style="overflow:auto;" class="hold-transition skin-blue sidebar-mini control-sidebar-open">
    <div class="wrapper">
        <header id="header" class="fixed-content main-header">
            <a href="entryPrescriptions.html" class="logo fixed" style="width: 13%;">
                <span class="logo-mini"><b>db</b></span>
                <span class="logo-lg"><b>dbotica</b></span>
            </a>
            <!-- Logo -->
            <!-- Header Navbar: style can be found in header.less -->
            <nav class="navbar navbar-fixed-top" role="navigation" style="margin-left: 13%;">
                <!-- Sidebar toggle button-->
                <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </a>
                <div class="navbar-custom-menu">
                    <ul class="nav navbar-nav">
                        <li class="dropdown user user-menu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <img src="dist/img/doctor (1).png" class="user-image" alt="User Image">
                                <span id="doctorNameInTheHeader" class="hidden-xs"></span>
                            </a>
                            <ul class="dropdown-menu">
                                <!-- User image -->
                                <li class="user-header">
                                    <img src="dist/img/doctor (1).png" class="img-circle" alt="User Image">
                                    <p id="doctorName">
                                    </p>
                                </li>
                                <!-- Menu Body -->
                                <!-- Menu Footer-->
                                <li class="user-footer">
                                    <div class="pull-left">
                                        <a href="doctorProfile.html" class="btn btn-default btn-flat">Profile</a>
                                    </div>
                                    <div class="pull-right">
                                        <a href="#" class="btn btn-default btn-flat" id="logoutButton">Sign out</a>
                                    </div>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>
        <!-- Left side column. contains the logo and sidebar -->
        <aside class="fixed-side-content main-sidebar" style="width: 13%;">
            <!-- sidebar: style can be found in sidebar.less -->
            <section class="sidebar">
                <!-- <a href="entryPrescriptions.html" class="logo">
                    <span class="logo-mini"><b>db</b></span>
                    <span class="logo-lg"><b>dbotica</b></span>
                </a> -->
                <!-- Sidebar user panel (optional) -->
                <div class="user-panel">
                    <div class="pull-left image">
                        <img src="dist/img/doctor (1).png" class="img-circle" alt="User Image">
                    </div>
                    <div class="pull-left info">
                        <p id="doctorNameInSideBar"></p>
                        <!-- Status -->
                        <span style="margin-bottom:2px;">Credits:<b style="color:white;" id="creditsInSideBar"></b></span>
                        <br>
                        <a href="doctorProfile.html">Profile</a>
                    </div>
                </div>
                <!-- Sidebar Menu -->
                <ul class="sidebar-menu">
                    <li class="header">Welcome</li>
                    <!-- Optionally, you can add icons to the links -->
                    <li class="active"><a href="entryPrescriptions.html"><i class="fa fa-link"></i> <span>Drug prescription</span></a></li>
                    <li><a href="myPrescriptions.html"><i class="fa fa-link"></i> <span>My Prescriptions</span></a></li>
                    <li><a href="myPatients.html"><i class="fa fa-link"></i> <span>My Patients</span></a></li>
                    <li><a href="myScheduler.html"><i class="fa fa-link"></i> <span>My Scheduler</span></a></li>
                    <li><a href="referADoctor.html"><i class="fa fa-link"></i> <span>Refer dbotica</span></a></li>
                    <li><a href="settings.html"><i class="fa fa-link"></i> <span>Settings</span></a></li>
                    <!--  <li class="active"><a href="../forms/PatientSearch.html"><i class="fa fa-link"></i> <span>Patient Search</span></a></li>  -->
                    <li class="treeview">
                        <!--  <a href="../tables/data.html"><i class="fa fa-link"></i> <span>Drug database</span> <i class="fa fa-angle-left pull-right"></i></a> -->
                    </li>
                </ul>
                <!-- /.sidebar-menu -->
            </section>
            <!-- /.sidebar -->
        </aside>
        <!-- Content Wrapper. Contains page content -->
        <div id="myPrescriptionsBody" class="content-wrapper" style="height:100%;width:100%;margin-left: 13%;margin-right: 22%;margin-top:3%;">
            <!-- <h3 id="myTemplatesHeader">My Templates</h3>
            <div class="templatesList">
                <a href=""></a>
            </div> -->
            <nav class="navbar navbar-default">
                <div class="navbar-header">
                    <a id="myTemplatesHeader" class="navbar-brand" href="javascript:void">My Templates</a>
                </div>
                <ul id="myTemplatesNav" class="nav navbar-nav">
                    <li id="templateOne"><a style="color:#3c8dbc;">Template 1</a></li>
                    <li id="templateTwo"><a style="color:#3c8dbc;">Template 2</a></li>
                    <li id="templateThree"><a style="color:#3c8dbc;">Template 3</a></li>
                </ul>
            </nav>
            <div id="templateOneBody">
                <table style="margin-left:10px;" class="table table-bordered">
                    <thead>
                        <tr>
                            <th width='15%;'>Name</th>
                            <th width='40%;'>Image</th>
                            <th width='20%;'>Comments</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
                <h3 id="addImageHeading">Add Image</h3>
                <div class="row">
                    <div class="col-md-9">
                        <form class="form-horizontal">
                            <div class="form-group">
                                <label for="inputImageName" class="col-md-1 col-sm-2 control-label">Name</label>
                                <div class=" col-md-6 col-sm-10">
                                    <input type="text" class="form-control" id="inputImageName" placeholder="Name">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="inputImageComments" class="col-md-1 col-sm-2 control-label">Comments</label>
                                <div class=" col-md-6 col-sm-10">
                                    <input type="text" class="form-control" id="inputImageComments" placeholder="Comments">
                                </div>
                            </div>
                            <div class="form-group">
                                <!--  <label style="margin-right:18px;" for="inputImageAdd" class="col-md-1 col-sm-2 control-label">Image</label>
                               <input id="inputFileButton" type="file" accept="image/*" onchange="loadFile(event)">
                               <div id="images">
                                   <a href="javascript:void">
                                       <img alt="add image" class="imageInSettings" id="output" /></a>
                                   <a href="javascript:void" class="del_photo"><img src="css/Actions-edit-delete-icon.png" id="deleteImageInSettings" border="0" /></a>
                               </div>
                               </span> -->
                                <label style="margin-right:18px;" for="inputImageAdd" class="col-md-1 col-sm-2 control-label">Image</label>
                                <input id="inputFileButton" type="file" accept="image/*" onchange="loadFile(event)">
                                <div class="canvasImage" class="tools">
                                    <a href="#tools_sketch" data-tool="marker">Marker</a>
                                    <a href="#tools_sketch" data-tool="eraser">Eraser</a>
                                    <a id="deleteImageInSettings" href="javascript:void">Delete</a>
                                </div>
                                <div id="images">
                                    <canvas class="canvasImage" id="tools_sketch" style=""></canvas>
                                    <!-- <a href="javascript:void" class="del_photo"><img src="css/Actions-edit-delete-icon.png" id="deleteImageInSettings" border="0" /></a> -->
                                </div>
                                <script type="text/javascript">
                                $(function() {
                                    $('#tools_sketch').sketch({
                                        defaultColor: "#ff0"
                                    });
                                });
                                </script>
                            </div>
                            <script>
                            var loadFile = function(event) {
                                $('#deleteImageInSettings').show();
                                var output = document.getElementById('output');
                                var url = URL.createObjectURL(event.target.files[0]);
                                $('#tools_sketch').css("background", 'url(' + url + ') no-repeat center center');
                                $('#tools_sketch').css("background-size", "100%");
                            };
                            </script>
                            <div class="form-group">
                                <div class="col-sm-offset-1 col-sm-10">
                                    <!-- <button type="submit" class="btn btn-default">Browse Image</button>
                                    <span> -->
                                    <button id="canvasImageSubmit" type="submit" class="btn btn-default">Save Image</button>
                                    </span>
                                </div>
                            </div>
                            <div id="imageAfterEditInCanvas"></div>
                        </form>
                    </div>
                </div>
                <!--  <input type="file" name="img"> -->
            </div>
            <div class="drugTemplateBody" id="templateTwoBody">
                <h4>Drug Template</h4>
                <button class="btn addDrugButtonInTemplate" data-toggle="modal" data-target="#drugTemplateModal">Add Drug</button>
                <div id="drugTemplateModal" class="modal fade" role="dialog">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4 class="modal-title">Add Drug Into Template</h4>
                            </div>
                            <div class="modal-body">
                                <form>
                                    <div class="form-group">
                                        <label for="exampleInputDrugName">Drug Name</label>
                                        <input type="text" class="form-control" id="exampleInputDrugName">
                                    </div>
                                    <div class="form-group">
                                        <label for="exampleInputRemarks">Remarks</label>
                                        <input type="text" class="form-control" id="exampleInputRemarks">
                                    </div>
                                    <div class="form-group">
                                        <label for="perServing">Per Serving</label>
                                        <input type="text" class="form-control" id="exampleInputPerServing">
                                    </div>
                                    <div class="form-group">
                                        <label for="daysOrQuantity">Days/Quantity</label>
                                        <select id="daysOrQuantSelectBox">
                                            <option value="Days">Days</option>
                                            <option value="Quantity">Quantity</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="drugsOrQuantity">No.of Days/Quantity Count</label>
                                        <input type="text" class="form-control" id="drugsOrQuantity">
                                    </div>
                                    <div class="form-group">
                                        <label for="exampleInputDrugTimings">Timings</label>
                                        <div class="col-md-12">
                                            <input type="button" id="drug-template-BBF" class="prescription-form-toggle-buttons col-md-1 btn btn-default btn-xs" value="BBF"></input>
                                            <input type="button" id="drug-template-ABF" class="prescription-form-toggle-buttons col-md-1 btn btn-default btn-xs" value="ABF"></input>
                                            <input type="button" id="drug-template-BL" class="prescription-form-toggle-buttons col-md-1 btn btn-default btn-xs" value="BL"></input>
                                            <input type="button" id="drug-template-AL" class="prescription-form-toggle-buttons col-md-1 btn btn-default btn-xs" value="AL"></input>
                                            <input type="button" id="drug-template-BD" class="prescription-form-toggle-buttons col-md-1 btn btn-default btn-xs" value="BD"></input>
                                            <input type="button" id="drug-template-AD" class="prescription-form-toggle-buttons col-md-1 btn btn-default btn-xs" value="AD"></input>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button id="addDrugBtnInModal" class="btn addDrugButtonInTemplate">Add Drug</button>
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
                <table class="table">
                    <thead>
                        <th width="10%;">Drug Name</th>
                        <th width="25%;">Drug Timings</th>
                        <th width="5%;">Per Serving</th>
                        <th width="5%;">No. of Days</th>
                        <th width="5%;">Quantity</th>
                        <th width="15%;">Remarks</th>
                        <th>Actions</th>
                    </thead>
                    <tbody id="drugArrayBody">
                    </tbody>
                </table>
            </div>
            <div id="templateThreeBody">
                <h1>Coming Soon!!!!!!!!!!!</h1>
            </div>
        </div>
        <!-- /.content-wrapper -->
        <footer class="main-footer" style="margin-left: 13%;width:100%;">
            <div class="pull-right hidden-xs">
                <b>Version</b> 1.0.0
            </div>
            <strong>Copyright &copy; 2015-2016 <a href="https://dbotica.com">Dbotica</a>.</strong> All rights reserved.
        </footer>
        <!-- Control Sidebar -->
        <!-- Control Sidebar -->
        <!-- /.control-sidebar -->
        <!-- Add the sidebar's background. This div must be placed
      immediately after the control sidebar -->
    </div>
    <!-- ./wrapper -->
    <!--added for register pop up --->
    <!-- jQuery 2.1.4 -->
    <!-- Bootstrap 3.3.5 -->
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="bootstrap/js/jquery.cookie.js"></script>
    <!-- FastClick -->
    <script src="plugins/fastclick/fastclick.min.js"></script>
    <!-- DataTables -->
    <script src="plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="plugins/datatables/dataTables.bootstrap.min.js"></script>
    <script src="dist/js/app.min.js"></script>
    <!-- AdminLTE for demo purposes -->
    <script src="dist/js/demo.js"></script>
    <!-- IndexedDB for local storage-->
    <script src="indexedDB/indexedDbotica.js"></script>
    <link rel="stylesheet" href="css/ionicons.css">
    <script src="js/jquery.form-validator.min.js"></script>
    <script>
    $.validate();
    </script>
    <script type="text/javascript">
    var drugsCountOnLoad = 0;
    var drugsArray = [];
    $(document).ready(function() {
        var totalDrugObjectsOnReady = [];
        try {
            openDb();
        } catch (e) {
            console.log("Error in openDb");
        }



        $.ajax({
            type: "GET",
            url: "http://localhost:8081/dbotica-spring/doctor/getDrugTemplates",
            beforeSend: function(xhr) {
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.setRequestHeader("Accept", "application/json");
            },
            xhrFields: {
                withCredentials: true
            },
            success: function(response) {


                drugArrayAll = $.parseJSON(response.response);
                console.log('get response is----', drugArrayAll);

                var idIndex = 0;
                var idCount = 0;
                for (var drugIndex = 0; drugIndex < drugArrayAll.length; drugIndex++) {
                    if (drugArrayAll[drugIndex].state == 'ACTIVE') {
                        var serialNumber = idIndex + 1;

                        drugsArray.push(drugArrayAll[drugIndex]);
                        $('#drugArrayBody').append('<tr  id="rowNumber' + drugArrayAll[drugIndex].id + '"><td>' + drugArrayAll[drugIndex].drugDosage.brandName + '</td><td>' + drugArrayAll[drugIndex].drugDosage.usageDirection + '</td><td>' + drugArrayAll[drugIndex].drugDosage.perServing + '</td><td>' + drugArrayAll[drugIndex].drugDosage.noOfDays + '</td><td>' + drugArrayAll[drugIndex].drugDosage.quantity + '</td><td>' + drugArrayAll[drugIndex].drugDosage.remarks + '</td><td><a id="' + drugArrayAll[drugIndex].id + '" data-toggle="modal" data-target="#drugTemplateModal" class="editDrugs" style="cursor:pointer;">Edit</a>|<a id="' + drugArrayAll[drugIndex].id + '" style="cursor:pointer;" class="deleteDrugs">Delete</td></tr>');
                        idIndex++;
                        idCount++;
                    }
                }
                drugsCountOnLoad = drugsArray.length;
            }
        });

        $('#deleteImageInSettings').hide();
        $('#templateOne').addClass('activeTemplate');
        $('#templateOneBody').show();
        $('#templateTwoBody').hide();
        $('#templateThreeBody').hide();
        $('#templateOne').click(function() {
            $('#templateTwo').removeClass('activeTemplate');
            $('#templateThree').removeClass('activeTemplate');
            $('#templateOne').addClass('activeTemplate');
            $('#templateTwoBody').hide();
            $('#templateThreeBody').hide();
            $('#templateOneBody').show();
        });
        $('#templateTwo').click(function() {
            $('#templateOne').removeClass('activeTemplate');
            $('#templateThree').removeClass('activeTemplate');
            $('#templateTwo').addClass('activeTemplate');
            $('#templateOneBody').hide();
            $('#templateThreeBody').hide();
            $('#templateTwoBody').show();
        });
        $('#templateThree').click(function() {
            $('#templateOne').removeClass('activeTemplate');
            $('#templateTwo').removeClass('activeTemplate');
            $('#templateThree').addClass('activeTemplate');
            $('#templateTwoBody').hide();
            $('#templateOneBody').hide();
            $('#templateThreeBody').show();
        });
    });

    $('#deleteImageInSettings').click(function() {
        $('#tools_sketch').css("background", "");
        $("#inputFileButton").val('');
        $('#deleteImageInSettings').hide();
    });

    var convertCanvasToImage = function(canvas) {
        var image = new Image();
        image.src = canvas.toDataURL("image/png");
        return image;
    }

    $('#canvasImageSubmit').click(function(e) {
        e.preventDefault();
        var canvas = document.getElementById("tools_sketch");
        console.log("canvas is----", document.getElementById("tools_sketch"));
        var imageAfterEdit = convertCanvasToImage(canvas);
        console.log("sjdkhsjkdf----", imageAfterEdit);
        $('#imageAfterEditInCanvas').append(imageAfterEdit);
    });

    $('.prescription-form-toggle-buttons').click(function(e) {
        var button = $(this);
        if (button.hasClass('btn-default')) {
            button.removeClass('btn-default').addClass('btn-success');
        } else if (button.hasClass('btn-success')) {
            button.removeClass('btn-success').addClass('btn-default');
        }
    });

    $(document).on('click', '.deleteDrugs', function(e) {

        var idIndex = this.id;
        var drugReadyToDelete = {};
        var drugtoDeleteId;

        for (var drugIn = 0; drugIn < drugsArray.length; drugIn++) {
            if (drugsArray[drugIn].id == idIndex) {
                drugReadyToDelete = drugsArray[drugIn];
                drugtoDeleteId = drugIn;
                break;
            } else {
                continue;
            }
        }

        drugReadyToDelete.state = 'INACTIVE';
        $.ajax({
            type: "POST",
            url: "http://localhost:8081/dbotica-spring/doctor/drugTemplate",
            beforeSend: function(xhr) {
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.setRequestHeader("Accept", "application/json");
            },
            xhrFields: {
                withCredentials: true
            },
            data: JSON.stringify(drugReadyToDelete),
            success: function(response) {
                console.log('response after deleting is----', response.response);
                $('#rowNumber' + [idIndex]).hide();
                drugsArray.splice(drugtoDeleteId, 1);

            }
        });
        console.log('id Index is---', idIndex);
    });

    var drugToEdit = {};
    $(document).on('click', '.editDrugs', function(e) {
        var idIndex = this.id;
        console.log('id index is---', idIndex);
        for (var drugIn = 0; drugIn < drugsArray.length; drugIn++) {
            console.log('drug in ----', drugsArray[drugIn]);
            if (drugsArray[drugIn].id == idIndex) {
                drugToEdit = drugsArray[drugIn];
            };
        }

        console.log('drug to edit is---', drugToEdit);
        selectedDrugId = drugToEdit.drugDosage.drugId;
        selectedDrugType = drugToEdit.drugDosage.drugType;
        $('#exampleInputPerServing').val(drugToEdit.drugDosage.perServing);
        $('#exampleInputDrugName').val(drugToEdit.drugDosage.brandName);
        $('#exampleInputRemarks').val(drugToEdit.drugDosage.remarks);
        $('#daysOrQuantSelectBox').val(drugToEdit.drugDosage.daysOrQuantity);
        $('#drugsOrQuantity').val(drugToEdit.drugDosage.units);
        var timingsArray = [];
        console.log('timings elements are---', drugToEdit.drugDosage.usageDirection);
        timingsArray = drugToEdit.drugDosage.usageDirection.split(', ');
        console.log('timings array is---', timingsArray);
        $("#drug-template-BBF").removeClass('btn-success');
        $("#drug-template-ABF").removeClass('btn-success');
        $("#drug-template-BL").removeClass('btn-success');
        $("#drug-template-AL").removeClass('btn-success');
        $("#drug-template-BD").removeClass('btn-success');
        $("#drug-template-AD").removeClass('btn-success');
        for (var timingIndex = 0; timingIndex < timingsArray.length; timingIndex++) {
            switch (timingsArray[timingIndex]) {
                case 'Before BreakFast':
                    $("#drug-template-BBF").addClass('btn-success');
                    break;
                case 'After BreakFast':
                    $("#drug-template-ABF").addClass('btn-success');
                    break;
                case 'Before Lunch':
                    $("#drug-template-BL").addClass('btn-success');
                    break;
                case 'After Lunch':
                    $("#drug-template-AL").addClass('btn-success');
                    break;
                case 'Before Dinner':
                    $("#drug-template-BD").addClass('btn-success');
                    break;
                case 'After Dinner':
                    $("#drug-template-AD").addClass('btn-success');
                    break;
            }
        }
    });


    $('#addDrugBtnInModal').click(function(e) {
        var drugReq = {};
        drugReq.doctorId = localStorage.getItem('doctorId');
        drugReq.drugDosage = {};
        drugReq.drugDosage.drugId = selectedDrugId;
        drugReq.drugDosage.drugType = selectedDrugType;
        var per_serving = $('#exampleInputPerServing').val();
        drugReq.drugDosage.brandName = $('#exampleInputDrugName').val();
        drugReq.drugDosage.remarks = $('#exampleInputRemarks').val();
        drugReq.drugDosage.perServing = $('#exampleInputPerServing').val();
        var quantOrdays = 'Days';
        quantOrdays = $('#daysOrQuantSelectBox option:selected').text();
        drugReq.drugDosage.daysOrQuantity = quantOrdays;
        drugReq.drugDosage.units = units;
        console.log('quant or days is---', quantOrdays);
        var usage = "";
        var quantCount = 0;
        if ($("#drug-template-BBF").hasClass('btn-success')) {
            usage = "Before BreakFast";
            quantCount++;
        }
        if ($("#drug-template-ABF").hasClass('btn-success')) {
            if (usage == "") {
                usage = "After BreakFast";
            } else {
                usage = usage + ", " + "After BreakFast";
            }
            quantCount++;
        }
        if ($("#drug-template-BL").hasClass('btn-success')) {
            if (usage == "") {
                usage = "Before Lunch";
            } else {
                usage = usage + ", " + "Before Lunch";
            }
            quantCount++;
        }
        if ($("#drug-template-AL").hasClass('btn-success')) {
            if (usage == "") {
                usage = "After Lunch";
            } else {
                usage = usage + ", " + "After Lunch";
            }
            quantCount++;
        }
        if ($("#drug-template-BD").hasClass('btn-success')) {
            if (usage == "") {
                usage = "Before Dinner";
            } else {
                usage = usage + ", " + "Before Dinner";
            }
            quantCount++;
        }
        if ($("#drug-template-AD").hasClass('btn-success')) {
            if (usage == "") {
                usage = "After Dinner";
            } else {
                usage = usage + ", " + "After Dinner";
            }
            quantCount++;
        }
        console.log('usage is---', usage);
        console.log('count is---', quantCount);
        drugReq.drugDosage['usageDirection'] = usage;
        var capsuleTypes = ['TABLET', 'CAPSULE', 'INJECTION', 'SACHET', 'LOZENGES', 'SUPPOSITORY', 'RESPULES', 'PEN', 'APLICAPS', 'ENEMA', 'PATCH'];
        var units = $('#drugsOrQuantity').val();
        drugReq.drugDosage.units = units;
        if ($.inArray(selectedDrugType, capsuleTypes) !== -1) {
            if (quantOrdays === 'Days') {
                if (per_serving == undefined || per_serving == '' || per_serving == null) {
                    per_serving = parseInt(1);
                }
                if (quantCount == 0) {
                    quantCount = 1;
                }
                if (units == undefined || units == '' || units == null) {
                    units = parseInt(1);
                    drugReq.drugDosage['noOfDays'] = units;
                    drugReq.drugDosage['quantity'] = parseInt(units) * quantCount * parseInt(per_serving);
                } else {
                    drugReq.drugDosage['noOfDays'] = units;
                    drugReq.drugDosage['quantity'] = parseInt(units) * quantCount * parseInt(per_serving);
                }

            } else {
                drugReq.drugDosage['quantity'] = units;
                drugReq.drugDosage['noOfDays'] = quantCount != 0 ? Math.ceil(parseInt(units) / (parseInt(per_serving) * quantCount)) : 1;
            }
        } else {
            if (quantOrdays === 'Days') {
                drugReq.drugDosage['noOfDays'] = units;
                drugReq.drugDosage['quantity'] = 1;
            } else {
                drugReq.drugDosage['quantity'] = units;
                drugReq.drugDosage['noOfDays'] = 1;
            }
        }
        if (jQuery.isEmptyObject(drugToEdit)) {
            console.log('inif loop edit==');
        } else {
            console.log('in edit else loop');
            drugReq.id = drugToEdit.id;
        }
        console.log('drug req is---', drugReq);
        $.ajax({
            type: "POST",
            url: "http://localhost:8081/dbotica-spring/doctor/drugTemplate",
            beforeSend: function(xhr) {
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.setRequestHeader("Accept", "application/json");
            },
            xhrFields: {
                withCredentials: true
            },
            data: JSON.stringify(drugReq),
            success: function(response) {
                console.log('response after adding is---', response);
                drugsCountOnLoad++;
                var drugInd = drugsCountOnLoad - 1;
                var drugDetailsResponse = $.parseJSON(response.response);
                drugsArray.push(drugDetailsResponse);
                var indexNew = drugsArray.length - 1;
                if (jQuery.isEmptyObject(drugToEdit)) {
                    console.log('inif loop edit==');
                } else {
                    console.log('in edit else loop');
                    $('#rowNumber' + [drugDetailsResponse.id]).hide();
                }
                $('#drugArrayBody').append('<tr  id="rowNumber' + drugDetailsResponse.id + '"><td>' + drugDetailsResponse.drugDosage.brandName + '</td><td>' + drugDetailsResponse.drugDosage.usageDirection + '</td><td>' + drugDetailsResponse.drugDosage.perServing + '</td><td>' + drugDetailsResponse.drugDosage.noOfDays + '</td><td>' + drugDetailsResponse.drugDosage.quantity + '</td><td>' + drugDetailsResponse.drugDosage.remarks + '</td><td><a drugId="' + drugDetailsResponse.id + '" class="editDrugs" style="cursor:pointer;" data-toggle="modal" data-target="#drugTemplateModal" id="editDrug' + drugInd + '">Edit</a>|<a drugId="' + drugDetailsResponse.id + '" style="cursor:pointer;" class="deleteDrugs" id="deleteDrug' + drugInd + '">Delete</td></tr>');
                $('#drugTemplateModal').modal('hide');
                drugToEdit = {};
            },
            error: function(request, status, error) {
                console.log('error is---', error);
                console.log('status is---', status);
            }
        });

    });
    var drugObjectsShown = [];
    var selectedDrugId;
    var selectedDrugType;
    $('#exampleInputDrugName').autocomplete({
        source: function(request, callback) {
            var searchParam = request.term;
            prescriptionFormDrugCallback(searchParam, callback)
        },
        minLength: 2,
        focus: function(event, ui) {
            event.preventDefault();
        },
        select: function(event, ui) {
            console.log('item to be selected is from array----', drugObjectsShown);
            ui.item.value = ui.item.value.split(" -")[0];
            for (var index = 0; index < drugObjectsShown.length; index++) {
                if (drugObjectsShown[index].brandName == ui.item.value) {
                    selectedDrugId = drugObjectsShown[index].id;
                    selectedDrugType = drugObjectsShown[index].drugType;
                }
            }
        }
    });

    function prescriptionFormDrugCallback(brandName, callback) {
        var drugObject = {};
        if (brandName === "") {
            $('.drugs-dropdown-menu').hide('dropdown');
            return;
        }
        autocompleteDrugIndexedDB(brandName, '#exampleInputDrugName', OnGetDrugsResponse, callback);
    }

    function OnGetDrugsResponse(data, callback) {
        var totalDrugObjects = [];
        if (data.length != 0) {
            drugObjectsShown = data;
            console.log('data is---', data);
            for (var i = 0, l = data.length; i < l; i++) {
                var drug = data[i];
                var brandNameString = drug['brandName'];
                if (drug['constituents']) {
                    brandNameString += " - "
                    var constituents = drug['constituents'];
                    for (var j in constituents) {

                        brandNameString += constituents[j]['molecule'] + " : " + constituents[j]['weight'] + ",";
                    }
                    brandNameString = brandNameString.slice(0, -1);
                }
                totalDrugObjects.push(brandNameString);
            }

        }
        callback(totalDrugObjects);
    }
    </script>
</body>

</html>
